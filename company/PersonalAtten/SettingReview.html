<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>考勤审核</title>
<link rel="stylesheet" type="text/css" href="../../css/iconFont/iconfont.css">

<link rel="stylesheet" type="text/css" href="../../layui/css/layui.css">
<link rel="stylesheet" type="text/css" href="../../layui/css/admin.css">
<script src="../../js/jquery.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/common.js?0.1"  type="text/javascript"></script>
</head>
<body layadmin-themealias="default">
    <div class="layui-fluid">
        <div class="layui-card">
            <div class="layui-tab layui-tab-brief" lay-filter="approval-tabs-brief">
                <ul class="layui-tab-title">
                    <li class="layui-this"  lay-id="1" ><i class="iconfont icon-suyaniconchanpinleibufenzuodaohangbufen87"></i>请假审核</li>
                    <li  lay-id="2" ><i class="iconfont icon-suyaniconchanpinleibufenzuodaohangbufen87"></i>外出审核</li>
                    <li  lay-id="3" ><i class="iconfont icon-suyaniconchanpinleibufenzuodaohangbufen87"></i>加班审核</li>
                    <li  lay-id="4" ><i class="iconfont icon-suyaniconchanpinleibufenzuodaohangbufen87"></i>考勤补录审核</li>
                </ul>
                <div class="layui-tab-content" id="approvalAll">
                    <!-- 请假 -->
                    <div class="layui-tab-item layui-show">
                        <div class="tab-pane Character modify-table-cell active" id="leaveAppr">
                            <div class="layui-form">
                                <div class="layui-form-item">
                                    
                                    <div class="layui-inline">
                                        <label class="layui-form-label">状态：</label>
                                        <div class="layui-input-block">
                                            <select name="leaveSelect" id="leaveSelect" lay-filter="leaveSelect">
                                                <option value="">全部</option>
                                                <option value="0">待审批</option>
                                                <option value="1">不通过</option>
                                                <option value="2">已通过</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <label class="layui-form-label">用户名：</label>
                                        <div class="layui-input-block">
                                            <input type="text" class="layui-input" id="SurveyTit">
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <label class="layui-form-label">开始时间：</label>
                                        <div class="layui-input-inline">
                                            <input type="text" name="leaveStartItem" id="leaveStartItem" class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <label class="layui-form-label">结束时间：</label>
                                        <div class="layui-input-inline">
                                            <input type="text" name="leaveEndItem" id="leaveEndItem" class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <button id="InquireSur" class="layui-btn" lay-event="InquireSur" title="查询"><i class="iconfont icon-sousuo"></i></button>
                                        <button id="InquireSurBack" class="layui-btn layui-btn-primary" style="display:none;"  lay-event="InquireSurBack">返回</button>
                                    </div>
                                </div>
                            </div>
                            <table class="layui-hide" id="leaveTable" lay-filter="leaveTable"></table>
                        </div>
                    </div>
                    <!-- 外出 -->
                    <div class="layui-tab-item">
                        <div class="tab-pane modify-table-cell Character" id="outgoAppr">
                            <div class="reviewCont">
                            </div>
                            <div class="layui-form">
                                <div class="layui-form-item">
                                    <div class="layui-inline">
                                        <label class="layui-form-label">状态：</label>
                                        <div class="layui-input-block">
                                            <select name="outgoSelect" id="outgoSelect" lay-filter="outgoSelect">
                                                <option value="">全部</option>
                                                <option value="0">待审批</option>
                                                <option value="1">不通过</option>
                                                <option value="2">已通过</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <label class="layui-form-label">用户名：</label>
                                        <div class="layui-input-block">
                                            <input type="text" class="layui-input" id="outgoTit">
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <label class="layui-form-label">开始时间：</label>
                                        <div class="layui-input-inline">
                                            <input type="text" name="outgoStartItem" id="outgoStartItem" class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <label class="layui-form-label">结束时间：</label>
                                        <div class="layui-input-inline">
                                            <input type="text" name="outgoEndItem" id="outgoEndItem" class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <button id="outgoSur" class="layui-btn" lay-event="outgoSur" title="查询"><i class="iconfont icon-sousuo"></i></button>
                                        <button id="outgoSurBack" class="layui-btn layui-btn-primary" style="display:none;"  lay-event="outgoSurBack">返回</button>
                                    </div>
                                </div>
                            </div>
                            <table class="layui-hide" id="outgoTable" lay-filter="outgoTable"></table>
                        </div>
                    </div>
                    <!-- 加班 -->
                    <div class="layui-tab-item">
                        <div class="tab-pane modify-table-cell Character" id="overTimeAppr">
                            <div class="reviewCont">
                            </div>
                            <div class="layui-form">
                                <div class="layui-form-item">                                
                                    <div class="layui-inline">
                                        <label class="layui-form-label">状态：</label>
                                        <div class="layui-input-block">
                                            <select name="overTimeSelect" id="overTimeSelect" lay-filter="overTimeSelect">
                                                <option value="">全部</option>
                                                <option value="0">待审批</option>
                                                <option value="1">不通过</option>
                                                <option value="2">已通过</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <label class="layui-form-label">用户名：</label>
                                        <div class="layui-input-block">
                                            <input type="text" class="layui-input" id="overTimeTit">
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <label class="layui-form-label">开始时间：</label>
                                        <div class="layui-input-inline">
                                            <input type="text" name="overTimeStartItem" id="overTimeStartItem" class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <label class="layui-form-label">结束时间：</label>
                                        <div class="layui-input-inline">
                                            <input type="text" name="overTimeEndItem" id="overTimeEndItem" class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <button id="overTime" class="layui-btn" lay-event="overTime" title="查询"><i class="iconfont icon-sousuo"></i></button>
                                        <button id="overTimeBack" class="layui-btn layui-btn-primary" style="display:none;"  lay-event="overTimeBack">返回</button>
                                    </div>
                                </div>
                            </div>
                            <table class="layui-hide" id="overTimeTable" lay-filter="overTimeTable"></table>
                        </div>
                    </div>
                    <!-- 考勤补录 -->
                    <div class="layui-tab-item">
                        <div class="tab-pane modify-table-cell Character" id="danceAppr">
                            <div class="reviewCont">
                            </div>
                            <div class="layui-form">
                                <div class="layui-form-item">                                                                
                                    <div class="layui-inline">
                                        <label class="layui-form-label">状态：</label>
                                        <div class="layui-input-block">
                                            <select name="danceSelect" id="danceSelect" lay-filter="danceSelect">
                                                <option value="">全部</option>
                                                <option value="0">待审批</option>
                                                <option value="1">不通过</option>
                                                <option value="2">已通过</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <label class="layui-form-label">用户名：</label>
                                        <div class="layui-input-block">
                                            <input type="text" class="layui-input" id="danceTit">
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                            <label class="layui-form-label">开始时间：</label>
                                            <div class="layui-input-inline">
                                                <input type="text" name="danceStartItem" id="danceStartItem" class="layui-input">
                                            </div>
                                        </div>
                                        <div class="layui-inline">
                                            <label class="layui-form-label">结束时间：</label>
                                            <div class="layui-input-inline">
                                                <input type="text" name="danceEndItem" id="danceEndItem" class="layui-input">
                                            </div>
                                        </div>
                                    <div class="layui-inline">
                                        <button id="danceSur" class="layui-btn" lay-event="danceSur" title="查询"><i class="iconfont icon-sousuo"></i></button>
                                        <button id="danceSurBack" class="layui-btn layui-btn-primary" style="display:none;"  lay-event="danceSurBack">返回</button>
                                    </div>
                                </div>
                            </div>
                            <table class="layui-hide" id="danceTable" lay-filter="danceTable"></table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</body>
<script src="../../layui/layui.js"></script>
<script>
    //审批

$(function(){
    layui.config({
		base: '../../../layui/' //静态资源所在路径
	}).extend({
		index: 'index' //主入口模块
	}).use(['index','form','laypage','table','laydate'], function(){
        var $ = layui.$
        ,admin = layui.admin
        ,element = layui.element
        ,router = layui.router();
        element.render();
        var laydate = layui.laydate
            ,form = layui.form
            ,layer = layui.layer
            ,laypage = layui.laypage
            ,table=layui.table;
        var leavetypes;
        var popUrl,forwardUrl;
        

        laydate.render({ 
            elem: '#danceStartItem'
            ,type: 'datetime'
        });
        laydate.render({ 
            elem: '#danceEndItem'
            ,type: 'datetime'
        });

         laydate.render({ 
            elem: '#overTimeStartItem'
            ,type: 'datetime'
        });
        laydate.render({ 
            elem: '#overTimeEndItem'
            ,type: 'datetime'
        });

        laydate.render({ 
            elem: '#outgoStartItem'
            ,type: 'datetime'
        });
        laydate.render({ 
            elem: '#outgoEndItem'
            ,type: 'datetime'
        });

        laydate.render({ 
            elem: '#leaveStartItem'
            ,type: 'datetime'
        });
        laydate.render({ 
            elem: '#leaveEndItem'
            ,type: 'datetime'
        });
        var TableDetailData;
        // 添加星期几
        function isNull(object){    
            if(object == null || typeof object == "undefined"){    
                return true;    
            }    
            return false;    
        };
        function getWeek(dateString){  
            var date;  
            if(isNull(dateString)){  
                date = new Date();  
            }else{  
                var dateArray = dateString.split("-");  
                date = new Date(dateArray[0], parseInt(dateArray[1] - 1), dateArray[2]);  
            }  
            return "星期" + "日一二三四五六".charAt(date.getDay());  
        }; 

        function forHtmlTable(s,e,elem,uid){//上下班记录表格
            // console.log(Ym);
            var startD = s.split(" ")[0];
            var endD =  e.split(" ")[0];
            var sArr= s.split("-");
            var eArr= e.split("-");
            var sY=sArr[0],sM=sArr[1];
            var eY=eArr[0],eM=eArr[1];
            var dataArr=[];
            var isSameM=false;
            
            //判断是否同月
            if((sY+'_'+sM) == (eY+'_'+eM)){
                isSameM=true
            }
            //获取区间内所有日期
            function gDate(datestr){
                var temp = datestr.split("-");
                var date = new Date(temp[0],temp[1],temp[2]);
                return date;
            }
            var startTime = gDate(startD);
            var endTime = gDate(endD);
            while((endTime.getTime()-startTime.getTime())>=0){
                var year = startTime.getFullYear();
                var month = startTime.getMonth().toString().length==1?"0"+startTime.getMonth().toString():startTime.getMonth();
                var day = startTime.getDate().toString().length==1?"0"+startTime.getDate():startTime.getDate();
                dataArr.push(year+"-"+month+"-"+day);
                startTime.setDate(startTime.getDate()+1);
            }
           
            $.fetch({ //默认打开显示未审批
                url: "/gateway/checkinout/usercheckinout",
                type: 'post',
                data: {
                    UserID: uid
                    ,Year:sY
                    ,Month:Number(sM)
                },
                cb: function (rs) {
                    
                    if(rs==null||rs.data_list==null){
                        elem.find("table tbody").html('<tr><td class="tc">暂无数据</td></tr>')
                    }else{
                        var usercheckinoutFun=function(rs,dataArr){
                            var o={
                                data_list:[],
                            }
                            for(var i = 0;i<rs.data_list.length;i++){
                                if(rs.data_list[i].table_header){
                                    o.data_list.push(rs.data_list[i])
                                }
                                for(var j = 0;j<dataArr.length;j++){
                                    if(dataArr[j]==rs.data_list[i].datetime  ){
                                        o.data_list.push(rs.data_list[i])
                                    }
                                }
                            }
                        
                            var thHtml= "",tbHtml="";
                            for(var i = 0;i<o.data_list.length;i++){ //列表拼接
                                if(o.data_list[i].table_header){
                                    // if(i==0){
                                    //     var monthTh=sY+'年'+sM+'月/';
                                    // }else{
                                    //     var monthTh='';
                                    // }
                                    tbHtml+=
                                    '<tr class="thead" style="background:#f2f2f2"><td><div class="layui-table-cell">'+o.data_list[i].datetime + '<span class="ml-5">' 
                                    +'</span></div></td>'
                                    +'<td><div class="layui-table-cell">'+o.data_list[i].time1 + '<span class="ml-5"></span></div></td>'
                                    +'<td><div class="layui-table-cell">'+o.data_list[i].time2 + '<span class="ml-5"></span></div></td>'
                                    +'<td><div class="layui-table-cell">'+o.data_list[i].time3 + '<span class="ml-5"></span></div></td>'
                                    +'<td><div class="layui-table-cell">'+o.data_list[i].time4+ '<span class="ml-5"></span></div></td>'
                                    +'</tr>'
                                }else{
                                
                                    var sunday = "公休日";
                                    var redTwo = "",redleave='';
                                    if( o.data_list[i].holiday) {
                                        redTwo = "TableContent";
                                    }
                                    if( o.data_list[i].isleave) {
                                        redleave = "redleave";
                                    }

                                    var ntime1,ntime2,ntime3,ntime4,descs; 

                                    var tc1 = o.data_list[i].time1.desc=="未登记"?'class="wdj"':'class="strong"';
                                    var tc2 = o.data_list[i].time2.desc=="未登记"?'class="wdj"':'class="strong"';
                                    var tc3 = o.data_list[i].time3.desc=="未登记"?'class="wdj"':'class="strong"';
                                    var tc4 = o.data_list[i].time4.desc=="未登记"?'class="wdj"':'class="strong"';

                                    ntime1= o.data_list[i].time1.desc=="正常"?'<td><div class="layui-table-cell">'+o.data_list[i].time1.time+'</div></td>' 
                                    :'<td class="red"><div class="layui-table-cell">'+o.data_list[i].time1.time+' ('+o.data_list[i].time1.desc+')</div></td>';
                                    
                                    ntime2= o.data_list[i].time2.desc=="正常"?'<td><div class="layui-table-cell">'+o.data_list[i].time2.time+'</div></td>' 
                                    :'<td class="red"><div class="layui-table-cell">'+o.data_list[i].time2.time+' ('+o.data_list[i].time2.desc+')</div></td>';
                                    
                                    ntime3= o.data_list[i].time3.desc=="正常"?'<td><div class="layui-table-cell">'+o.data_list[i].time3.time+'</div></td>' 
                                    :'<td class="red"><div class="layui-table-cell">'+o.data_list[i].time3.time+' ('+o.data_list[i].time3.desc+')</div></td>';
                                    
                                    ntime4= o.data_list[i].time4.desc=="正常"?'<td><div class="layui-table-cell">'+o.data_list[i].time4.time+'</div></td>' 
                                    :'<td class="red"><div class="layui-table-cell">'+o.data_list[i].time4.time+' ('+o.data_list[i].time4.desc+')</div></td>';
                                    
                                    tbHtml+=
                                    '<tr class="'+redTwo+' '+(redTwo==''?redleave:'')+'"><td><div class="layui-table-cell">'+o.data_list[i].datetime + '<span class="ml-5">'+ getWeek(o.data_list[i].datetime) +
                                    '</span></div></td>'+ntime1+''+ntime2+''+ntime3+''+ntime4+
                                    '</tr>'
                                    // <td><div class="layui-table-cell"><span class="DayDetail" data-days="'+o.data_list[i].datetime+'">查看详情</span></div></td>
                                }

                            }   
                        
                            return tbHtml
                        }
                        elem.find("table tbody").html(usercheckinoutFun(rs,dataArr));
                        if(!isSameM){
                            setTimeout(function(){
                                $.fetch({ //默认打开显示未审批
                                    url: "/gateway/checkinout/usercheckinout",
                                    type: 'post',
                                    data: {
                                        UserID: uid
                                        ,Year:eY
                                        ,Month:Number(eM)
                                    },
                                    cb: function (res) {
                                        elem.find("table tbody").append(usercheckinoutFun(res,dataArr)) 
                                    }
                                })
                            },1);
                        }
                    }
                }
            })
        }
        var leaveTableDetail=function(dataId,tdata,TableID){///gateway/userleave/approvallist
            $.fetch({ //默认打开显示未审批e
                    url: "/gateway/userleave/attachlist",
                    type: 'post',
                    data: {
                        LeaveApplyID: dataId,
                        // LeaveApplyID: tdata.id,
                    },
                    cb: function (rs) {
                        var attach='暂无附件';
                        if(rs&&rs.length>0){
                            attach='';
                            for(var i=0;i<rs.length;i++){
                                attach+='<a title="点击下载" class="seeXqOutIn" target="_blank" href="/gateway/userleave/download/'+rs[i].id+'" >'+rs[i].original_name+'</a>'
                            }
                        }
                        var histry = '';
                        if (tdata.approval_history.length > 0) {
                            for (var k = 0; k < tdata.approval_history.length; k++) {
                                var res = '';
                                var classList = '';
                                if (tdata.approval_history[k].is_forward == 1) { //是转发的
                                    res = '--转发-->';

                                    histry += '<p>【' + tdata.approval_history[k].username + '' + res + '' + tdata.approval_history[k].forward_username + '' //名字
                                        //意见

                                        +
                                        '<em class=' + classList + '> ' +
                                        tdata.approval_history[k].approval_time + '</em>】：<span class="list" title=' + tdata.approval_history[k].content + '>' //时间
                                        +
                                        tdata.approval_history[k].content + '</p>' //意见内容

                                } else { //是审批的

                                    if (tdata.approval_history[k].approval_result == 1) {
                                        res = '未通过';
                                        classList = "red";
                                    } else if (tdata.approval_history[k].approval_result == 2) {
                                        res = '已通过';
                                        classList = "green";
                                    }

                                    histry += '<p>【' + tdata.approval_history[k].username + '<em class=' + classList + '>' //名字
                                        +
                                        res + '' //意见
                                        +
                                        tdata.approval_history[k].approval_time + '</em>】：<span class="list" title=' + tdata.approval_history[k].content + '>' //时间
                                        +
                                        tdata.approval_history[k].content + '</p>' //意见内容
                                }
                            }
                        } else {
                            histry = "暂无审批记录"
                        }
                        var htmlsAudit=''
                        if(tdata.can_approval==true){
                            htmlsAudit ='<div class="layui-card" id="approvPop">'
                            +'<div class="reviewCont layui-card-body">'
                            +    '<div class="layui-form" action="">'
                            +        '<div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label">审批意见：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<textarea id="appDacText" name="suggestion" class="layui-textarea" cols="50" rows="4" ></textarea>'
                            +            '</div>'
                            +        '</div>'
                            +        '<div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label">是否同意：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalOk" value="2" title="同意" checked>'
                            +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalNo" value="1" title="不同意">'
                            +            '</div>'
                            +        '</div>'
                            +        '<div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label">审批人：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<div class="layui-input-inline">'
                            +                    '<select name="nextDacApp" lay-verify="required" id="nextDacApp"></select>'
                            +                '</div>'
                            +            '</div>'
                            +        '</div>'
                            +       ' <div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label modify-layui-width">选择转交人：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<div class="layui-input-inline MaxHeight">'
                            +                    '<select name="dacAppForward" lay-verify="required" id="dacAppForward"></select>'
                            +                '</div>'
                            +                '<button class="layui-btn" data-item="'+tdata.id+'" id="okForward">转发</button>'
                            +           ' </div>'
                            +       ' </div>'
                            +        '<div class="layui-form-item">'
                            +            '<div class="layui-input-block">'
                            +               ' <button class="appOk layui-btn" data-item="'+tdata.id+'">确认</button>'
                            +            '</div>'
                            +        '</div>'
                            +    '</div>'
                            +'</div>'
                            +'</div>' 
                        }
                        
                        // 详情审批
                        $.managerFun({
                            departmentId:tdata.department_id,
                            step:tdata.next_step,
                            applyuserId:tdata.apply_user_id,
                            approvalType:tdata.approval_type,
                            itemId:tdata.id,
                            fun:function(rs,forw,steps){
                                var oplhtml ='';
                                for(var i=0;i<rs.length;i++){
                                    oplhtml+='<option value="'+rs[i].id+'">'+rs[i].name+'</option>'
                                }
                                $("#nextDacApp").html(oplhtml); 
                                $("#nextDacApp").attr("data-step",steps);
                                form.render(); 
                                if(forw&&forw.length!=0){
                                    var forwHtml ='';
                                    for(var i=0;i<forw.length;i++){
                                        forwHtml+='<option value="'+forw[i].id+'">'+forw[i].name+'</option>'
                                    }
                                    $("#dacAppForward").html(forwHtml);
                                    form.render(); 
                                }else{
                                    $("#dacAppForward").parents('.layui-form-item').remove();
                                }
                                
                                var elem =$(this).parents(tdata.id);
                                var TableID = "leaveTable";
                                $("#approvPop").find(" input[value='2']").prop("checked",true);
                                apprPopFun(elem,popUrl,forwardUrl,TableID);
                            }
                            })
                        form.on('radio(approvalYn)', function(data){
                            if(data.value==1){
                                $("#dacAppForward").attr("disabled","disabled");
                                $("#okForward").attr("disabled","disabled").addClass("disabled");
                                form.render();
                            }else if(data.value==2){
                                $("#dacAppForward").removeAttr("disabled");
                                $("#okForward").removeAttr("disabled").removeClass("disabled");
                                form.render();
                            }
                        }); 
                    
                        var htmls ='<div class="layui-card" style="min-height:300px">'
                            +'<div class="layui-card-body">'
                                    +'<div class="reviewCont layui-card-body layui-form">'
                                        +'<div class="layui-form-item">'
                                            +'<div class="layui-inline">'
                                                +'<label class="layui-form-label">申请人：</label>'
                                                +'<div class="layui-input-inline cateID">'
                                                    +'<span>'+tdata.apply_user_name+'</span>'
                                                +'</div>'
                                            +'</div>'
                                            +'<div class="layui-inline">'
                                                +'<label class="layui-form-label">申请时间：</label>'
                                                +'<div class="layui-input-inline cateID">'
                                                    +'<span>'+tdata.apply_time+'</span>'
                                                +'</div>'
                                            +'</div>'

                                            +'<div class="layui-inline">'
                                                +'<label class="layui-form-label">请假类型：</label>'
                                                +'<div class="layui-input-inline cateID">'
                                                    +'<span>'+leavetypes[tdata.leave_type]+''+(tdata.is_cancel==1?'(取消申请)':'')+'</span>'
                                                +'</div>'
                                            +'</div>'
                                            
                                        +'</div>'
                                        +'<div class="layui-form-item">'
                                            +'<label class="layui-form-label">请假天数：</label>'
                                            +'<div class="layui-input-block cateID ">'
                                                +'<span>'+tdata.day_count+'</span>'
                                            +'</div>'
                                        +'</div>'
                                        +'<div class="layui-form-item">'
                                            +'<label class="layui-form-label">请假时间：</label>'
                                            +'<div class="layui-input-block cateID ">'
                                                +'<span>'+tdata.start_time+'~'+tdata.end_time+'</span>'
                                            +'</div>'
                                        +'</div>'
                                        +'<div class="layui-form-item">'
                                            +'<label class="layui-form-label">请假原因：</label>'
                                            +'<div class="layui-input-block cateID">'
                                                +'<span>'+tdata.content+'</span>'
                                            +'</div>'
                                        +'</div>'
                                        // +'<div class="layui-form-item">'
                                        //     +'<label class="layui-form-label">状态：</label>'
                                        //     +'<div class="layui-input-block cateID">'
                                        //         +'<span>'+tdata.apply_result_desc +' '+(tdata.is_cancel==1?'<span class="green">(取消请假申请)</span>':'')+'</span>'
                                        //     +'</div>'
                                        // +'</div>'
                                    +'</div>'
                                    +'<fieldset class="layui-elem-field">'
                                        +'<legend>附件</legend>'
                                        +'<div class="layui-field-box">'+attach+'</div>'
                                    +'</fieldset>'
                                    +'<fieldset class="layui-elem-field">'
                                        +'<legend>审批历史</legend>'
                                        +'<div class="layui-field-box">'+histry+'</div>'
                                    +'</fieldset>'
                                    +htmlsAudit
                                +'</div>'
                                +'</div>'
                        layer.open({
                            type: 1,
                            title: "请假详情",
                            area: ['auto'],
                            content: htmls,
                            success:function(layero,index){
                                form.render();
                            }
                        })

                    }
                })
        }
        // var layid = location.hash.replace(/^?test1=/, '');
        var leaveTable;
        
        var urlTab = location.href.split('?tab=')[1]?location.href.split('?tab=')[1]:false;
        var tabId=urlTab?urlTab.split('?')[0]:false;
        var dataId = location.href.split('?id=')[1]?location.href.split('?id=')[1]:false;
        if(dataId){
            if(tabId==1){
                var tableSub0={
                    ID:dataId
                }
            }
            if(tabId==2){
                var tableSub1={
                    ID:dataId
                }
            }
            if(tabId==3){
                var tableSub2={
                    ID:dataId
                }
            }
            if(tabId==4){
                var tableSub3={
                    ID:dataId
                }
            }
        }else{
            var tableSub0={}
            var tableSub1={}
            var tableSub2={}
            var tableSub3={}
        }
        // var tabId=urlTab.split('?tab=')[1]?location.href.split('?tab=')[1]:false;
        // var dataId=location.href.split('?tab=')[1]?location.href.split('?tab=')[1]:false;

        
    // 修正浮动栏高度
    // @param tableElem 表格显示div
    function autoFixed(tableElem) {
        var $tableView = tableElem || $(".layui-table-view");
        var dataIndex ,trHeight;
        $tableView.each(function() {
            // 获取两侧浮动栏
            var $fixed = $(this).find(".layui-table-fixed");
            // 同步表头高度
            $fixed.find(".layui-table-header tr").height($(this).find(".layui-table-header tr").eq(0).height());
            // 遍历tr 修正浮动栏行高
            $(this).find(".layui-table-main tr").each(function() {
                dataIndex = $(this).attr("data-index");
                trHeight = $(this).css("height");
                $fixed.find("tr[data-index=" + dataIndex + "]").css("height", trHeight);
            })
        });
    }
    // 监听浏览器窗口大小变化
    var resizeTimer;
    $(window).resize(function() {
        if (resizeTimer) {
            clearTimeout(resizeTimer);
        }
        resizeTimer = setTimeout(function() {
            resizeTimer = null;
            autoFixed();
        },
        200);
    });

    // 监听表头鼠标按下事件
    $(document).on('mousedown', 'thead',
    function(e) {
        var that = $(this);
        $(document).one('mouseup',
        function() {
            autoFixed(that.parents('.layui-table-view'));
        })
    });
     

     
   
    // 弹窗
    table.on('tool(leaveTable)', function (obj) {
        var tdata = obj.data; //获得当前行数据
        var layEvent = obj.event;
        if(layEvent=="Approval"){
            var htmls ='<div class="layui-card">'
                        +'<div class="reviewCont layui-card-body">'
                        +    '<div class="layui-form" action="">'
                        +        '<div class="layui-form-item">'
                        +            '<label class="layui-form-label modify-layui-label">审批意见：</label>'
                        +            '<div class="layui-input-block">'
                        +                '<textarea id="appDacText" name="suggestion" class="layui-textarea" cols="50" rows="4" ></textarea>'
                        +            '</div>'
                        +        '</div>'
                        +        '<div class="layui-form-item">'
                        +            '<label class="layui-form-label modify-layui-label">是否同意：</label>'
                        +            '<div class="layui-input-block">'
                        +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalOk" value="2" title="同意" checked>'
                        +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalNo" value="1" title="不同意">'
                        +            '</div>'
                        +        '</div>'
                        +        '<div class="layui-form-item">'
                        +            '<label class="layui-form-label modify-layui-label">审批人：</label>'
                        +            '<div class="layui-input-block">'
                        +                '<div class="layui-input-inline">'
                        +                    '<select name="nextDacApp" lay-verify="required" id="nextDacApp"></select>'
                        +                '</div>'
                        +            '</div>'
                        +        '</div>'
                        +       ' <div class="layui-form-item">'
                        +            '<label class="layui-form-label modify-layui-label modify-layui-width">选择转交人：</label>'
                        +            '<div class="layui-input-block">'
                        +                '<div class="layui-input-inline MaxHeight">'
                        +                    '<select name="dacAppForward" lay-verify="required" id="dacAppForward"></select>'
                        +                '</div>'
                        +                '<button class="layui-btn" data-item="'+tdata.id+'" id="okForward">转发</button>'
                        +           ' </div>'
                        +       ' </div>'
                        +        '<div class="layui-form-item">'
                        +            '<div class="layui-input-block">'
                        +               ' <button class="appOk layui-btn" data-item="'+tdata.id+'">确认</button>'
                        +            '</div>'
                        +        '</div>'
                        +    '</div>'
                        +'</div>'
                        +'</div>'

            layer.open({
                title:'审批意见',
                content:htmls,
                type:1,
                id:'approvPop',
                area:['60%','51%'],
                success:function(layero,index){
                    form.render(); 
                    $.managerFun({
                        departmentId:tdata.department_id,
                        step:tdata.next_step,
                        applyuserId:tdata.apply_user_id,
                        approvalType:tdata.approval_type,
                        itemId:tdata.id,
                        fun:function(rs,forw,steps){
                            var oplhtml ='';
                            for(var i=0;i<rs.length;i++){
                                oplhtml+='<option value="'+rs[i].id+'">'+rs[i].name+'</option>'
                            }
                            $("#nextDacApp").html(oplhtml); 
                            $("#nextDacApp").attr("data-step",steps);
                            form.render(); 
                            if(forw&&forw.length!=0){
                                var forwHtml ='';
                                for(var i=0;i<forw.length;i++){
                                    forwHtml+='<option value="'+forw[i].id+'">'+forw[i].name+'</option>'
                                }
                                $("#dacAppForward").html(forwHtml);
                                form.render(); 
                            }else{
                                $("#dacAppForward").parents('.layui-form-item').remove();
                            }
                            
                            var elem =$(this).parents(tdata.id);
                            var TableID = "leaveTable";
                            $("#approvPop").find(" input[value='2']").prop("checked",true);
                            apprPopFun(elem,popUrl,forwardUrl,TableID);
                        }
                        })
                    form.on('radio(approvalYn)', function(data){
                        if(data.value==1){
                            $("#dacAppForward").attr("disabled","disabled");
                            $("#okForward").attr("disabled","disabled").addClass("disabled");
                            form.render();
                        }else if(data.value==2){
                            $("#dacAppForward").removeAttr("disabled");
                            $("#okForward").removeAttr("disabled").removeClass("disabled");
                            form.render();
                        }
                    });  
                }
            })
        }else if(layEvent=="detail"){
            TableDetailData=tdata;
            var TableID = "leaveTable";
            leaveTableDetail(tdata.id,tdata,TableID)
          
        }
    })
    // 筛选
    $("#InquireSur").on("click",function(){
        var UserName = $("#SurveyTit").val();
        var ApprovalResult = $("#leaveSelect").val();
        var  leaveEndItem = $("#leaveEndItem").val();
        var  leaveStartItem = $("#leaveStartItem").val();
  
        leaveTable.reload({
            where: {//记录搜索状态
                ID:'',
                ApprovalResult:ApprovalResult,
                UserName: UserName,
                StartTime:leaveStartItem,
                EndTime:leaveEndItem,
            },
            page: {
                curr: 1 //重新从第 1 页开始
            }
           ,done:function(data){
            autoFixed($(this.elem[0]).next());
               
                for(var i =0; i<data.data.length; i++){
                    if(data.data[i].can_approval==true){
                        $("#leaveAppr .layui-table-main tr").eq(i).addClass("ColorPrompt")
                    }else{
                        $("#leaveAppr .layui-table-main tr").eq(i).removeClass("ColorPrompt")
                    }
                    
                }
                $("#SurveyTit").val(this.where.UserName);
                $("#leaveSelect").val(this.where.ApprovalResult);
                form.render();
           }
        });
        if (UserName !== "" || ApprovalResult !== "") {
            $("#InquireSurBack").css('display', 'inline-block');
        } else {
            $("#InquireSurBack").css('display', 'none');
        }
    })
    // 返回
    $("#InquireSurBack").on("click",function(){
        leaveTable.reload({
            where:{
                ID:''
            },
            page: {
                curr: 1 //重新从第 1 页开始
            }
           ,done:function(data){
            autoFixed($(this.elem[0]).next());
               
                for(var i =0; i<data.data.length; i++){
                    if(data.data[i].can_approval==true){
                        $("#leaveAppr .layui-table-main tr").eq(i).addClass("ColorPrompt")
                    }else{
                        $("#leaveAppr .layui-table-main tr").eq(i).removeClass("ColorPrompt")
                    }
                    
                }
                $("#SurveyTit").val(this.where.UserName);
                $("#leaveSelect").val(this.where.ApprovalResult);
                form.render();
           }
        });
        $("#InquireSurBack").css('display', 'none');
    })

    // 外出
    var outgoTableFun=function(){
        var outgoTable = table.render({
            elem: '#outgoTable'
            ,url:urls+'/gateway/goout/approvallist'
            ,contentType: 'application/json',
            content: '<div class="layui-card"><div class="layui-card-body layui-form modify-table-cell"><table lay-filter="overtime-History-table" class="layui-table" id="overtime-History-table"></table></div></div>',
            method: 'post',
            where:tableSub1,
            page: true, //开启分页
            // limits:false,
            limits:[10,20,30,40,50,60,70,80,90,100,200,500,1000,5000],
            toolbar:false,
            loading: true,
            toolbar: '',
            defaultToolbar: ''
            ,text: {
                none: '暂无数据' //默认：无数据。注：该属性为 layui 2.2.5 开始新增
            }
            ,cols: [[
            {field:'depatment_name', minWidth:100, title: '部门'}
            ,{field:'apply_user_name', minWidth:80, title: '姓名'}
            ,{field:'start_time', minWidth:160, title: '开始时间'}
            ,{field:'end_time', title: '结束时间', minWidth: 160}
            ,{
                field:'experience', 
                minWidth:120, 
                title: '外出类型',
                templet:function(d){
                    var expCont = d.go_out_type==2?'出差':'外出';
                    return expCont+' '+(d.is_cancel==1?'<span class="green">(取消中)</span>':d.is_cancel==2?'<span class="green">(已取消)</span>':'')
                }
            }
            ,{field:'location', minWidth:120, title: '外出地点'}
            ,{field:'apply_time', minWidth:160, title: '申请时间'}
            ,{
                field:'content', 
                minWidth:120, 
                title: '外出原因',
            }
            ,{
                field:'approval_history', 
                minWidth:320, 
                title: '审批意见',
                templet:function(d){
                    var yj='';
                    if(d.approval_history.length==0){
                        yj ='暂无';
                    }else{
                        for(var k=0;k< d.approval_history.length;k++){
                            var res='';
                            var classList = '';
                            if(d.approval_history[k].is_forward ==1){//是转发的
                                res ='--转发-->';
                                yj+='<p>【'+d.approval_history[k].username+''+res+ ''+d.approval_history[k].forward_username+''//名字
                                                //意见
                                        +'<em class='+classList+'> ' +d.approval_history[k].approval_time+'</em>】：'//时间
                                            +d.approval_history[k].content+'</p>'//意见内容

                            }else{//是审批的
                                if(d.approval_history[k].approval_result==1){
                                    res ="未批准";
                                    classList = "red";
                                }else if(d.approval_history[k].approval_result==2){
                                    res ="已批准";
                                    classList = 'green';
                                }
                                yj+='<p><span> 【'+d.approval_history[k].username +'<em class='+classList+'>'+res+' '+d.approval_history[k].approval_time+'</em>'+'】</span>'+d.approval_history[k].content+'</p>'
                        
                            };
                        }
                    }
                    return yj
                }
            }
            ,{
                field:'apply_time', 
                fixed: 'right',
                minWidth:120, 
                title: '操作',
                templet:function(d){
                    return d.can_approval==true?'<a class="layui-btn layui-btn-xs" lay-event="OUTroval">审批</a> <a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>':'<a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>'
                }
            }

            ]],
            request: {
                pageName: 'currentIndex' //页码的参数名称，默认：page
                    ,
                limitName: 'pageSize' //每页数据量的参数名，默认：limit
            },
            parseData: function (res) { //res 即为原始返回的数据
                return {
                    "status_code": res.status_code, //解析接口状态
                    "message": res.message, //解析提示文本
                    "count": res.data.total_count, //解析数据长度
                    "data": res.data.data_list, //解析数据列表
                    "curr": res.data.page_index
                };
            },
            done:function(data){
                for(var i =0; i<data.data.length; i++){
                    if(data.data[i].can_approval==true){
                        $("#outgoAppr .layui-table-main tr").eq(i).addClass("ColorPrompt")
                    }else{
                        $("#outgoAppr .layui-table-main tr").eq(i).removeClass("ColorPrompt")
                    }
                    
                }
                form.render();
                if(tableSub1&&tableSub1.ID&&this.where.ID!=''){
                    $('div#outgoAppr .layui-table-body.layui-table-main a[lay-event="detail"]').click();
                }
                autoFixed($(this.elem[0]).next());
            }
        })
   
        // 弹窗
        table.on('tool(outgoTable)', function (obj) {
            var tdata = obj.data; //获得当前行数据
            var layEvent = obj.event;
            if(layEvent=="OUTroval"){
                var htmls ='<div class="layui-card">'
                            +'<div class="reviewCont layui-card-body">'
                            +    '<div class="layui-form" action="">'
                            +        '<div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label">审批意见：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<textarea id="appDacText" name="suggestion" class="layui-textarea" cols="50" rows="4" ></textarea>'
                            +            '</div>'
                            +        '</div>'
                            +        '<div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label">是否同意：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalOk" value="2" title="同意" checked>'
                            +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalNo" value="1" title="不同意">'
                            +            '</div>'
                            +        '</div>'
                            +        '<div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label">审批人：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<div class="layui-input-inline">'
                            +                    '<select name="nextDacApp" lay-verify="required" id="nextDacApp"></select>'
                            +                '</div>'
                            +            '</div>'
                            +        '</div>'
                            +       ' <div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label modify-layui-width">选择转交人：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<div class="layui-input-inline MaxHeight">'
                            +                    '<select name="dacAppForward" lay-verify="required" id="dacAppForward"></select>'
                            +                '</div>'
                            +                '<button class="layui-btn" data-item="'+tdata.id+'" id="okForward">转发</button>'
                            +           ' </div>'
                            +       ' </div>'
                            +        '<div class="layui-form-item">'
                            +            '<div class="layui-input-block">'
                            +               ' <button class="appOk layui-btn" data-item="'+tdata.id+'">确认</button>'
                            +            '</div>'
                            +        '</div>'
                            +    '</div>'
                            +'</div>'
                            +'</div>'

                layer.open({
                    title:'审批意见',
                    content:htmls,
                    type:1,
                    id:'approvPop',
                    area:['60%','51%'],
                    success:function(layero,index){
                        form.render(); 
                        $.managerFun({
                            departmentId:tdata.department_id,
                            step:tdata.next_step,
                            applyuserId:tdata.apply_user_id,
                            approvalType:tdata.approval_type,
                            itemId:tdata.id,
                            fun:function(rs,forw,steps){
                                var oplhtml ='';
                                for(var i=0;i<rs.length;i++){
                                    oplhtml+='<option value="'+rs[i].id+'">'+rs[i].name+'</option>'
                                }
                                $("#nextDacApp").html(oplhtml); 
                                $("#nextDacApp").attr("data-step",steps);
                                form.render(); 
                                if(forw&&forw.length!=0){
                                    var forwHtml ='';
                                    for(var i=0;i<forw.length;i++){
                                        forwHtml+='<option value="'+forw[i].id+'">'+forw[i].name+'</option>'
                                    }
                                    $("#dacAppForward").html(forwHtml);
                                    form.render(); 
                                }else{
                                    $("#dacAppForward").parents('.layui-form-item').remove();
                                }
                                
                                var elem =$(this).parents(tdata.id);
                                var TableID = "outgoTable";
                                $("#approvPop").find(" input[value='2']").prop("checked",true);
                                apprPopFun(elem,popUrl,forwardUrl,TableID);
                            }
                        })
                        form.on('radio(approvalYn)', function(data){
                            if(data.value==1){
                                $("#dacAppForward").attr("disabled","disabled");
                                $("#okForward").attr("disabled","disabled").addClass("disabled");
                                form.render();
                            }else if(data.value==2){
                                $("#dacAppForward").removeAttr("disabled");
                                $("#okForward").removeAttr("disabled").removeClass("disabled");
                                form.render();
                            }
                        });  
                    }
                })
            }else if(layEvent=="detail"){ 
                var histry = '';
                if (tdata.approval_history.length > 0) {
                    for (var k = 0; k < tdata.approval_history.length; k++) {
                        var res = '';
                        var classList = '';
                        if (tdata.approval_history[k].is_forward == 1) { //是转发的
                            res = '--转发-->';

                            histry += '<p>【' + tdata.approval_history[k].username + '' + res + '' + tdata.approval_history[k].forward_username + '' //名字
                                //意见

                                +
                                '<em class=' + classList + '> ' +
                                tdata.approval_history[k].approval_time + '</em>】：<span class="list" title=' + tdata.approval_history[k].content + '>' //时间
                                +
                                tdata.approval_history[k].content + '</p>' //意见内容

                        } else { //是审批的

                            if (tdata.approval_history[k].approval_result == 1) {
                                res = '未通过';
                                classList = "red";
                            } else if (tdata.approval_history[k].approval_result == 2) {
                                res = '已通过';
                                classList = "green";
                            }

                            histry += '<p>【' + tdata.approval_history[k].username + '<em class=' + classList + '>' //名字
                                +
                                res + '' //意见
                                +
                                tdata.approval_history[k].approval_time + '</em>】：<span class="list" title=' + tdata.approval_history[k].content + '>' //时间
                                +
                                tdata.approval_history[k].content + '</p>' //意见内容
                        }
                    }
                } else {
                    histry = "暂无审批记录"
                }

                var htmlsAudit=''
                if(tdata.can_approval==true){
                    htmlsAudit ='<div class="layui-card" id="approvPop">'
                    +'<div class="reviewCont layui-card-body">'
                    +    '<div class="layui-form" action="">'
                    +        '<div class="layui-form-item">'
                    +            '<label class="layui-form-label modify-layui-label">审批意见：</label>'
                    +            '<div class="layui-input-block">'
                    +                '<textarea id="appDacText" name="suggestion" class="layui-textarea" cols="50" rows="4" ></textarea>'
                    +            '</div>'
                    +        '</div>'
                    +        '<div class="layui-form-item">'
                    +            '<label class="layui-form-label modify-layui-label">是否同意：</label>'
                    +            '<div class="layui-input-block">'
                    +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalOk" value="2" title="同意" checked>'
                    +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalNo" value="1" title="不同意">'
                    +            '</div>'
                    +        '</div>'
                    +        '<div class="layui-form-item">'
                    +            '<label class="layui-form-label modify-layui-label">审批人：</label>'
                    +            '<div class="layui-input-block">'
                    +                '<div class="layui-input-inline">'
                    +                    '<select name="nextDacApp" lay-verify="required" id="nextDacApp"></select>'
                    +                '</div>'
                    +            '</div>'
                    +        '</div>'
                    +       ' <div class="layui-form-item">'
                    +            '<label class="layui-form-label modify-layui-label modify-layui-width">选择转交人：</label>'
                    +            '<div class="layui-input-block">'
                    +                '<div class="layui-input-inline MaxHeight">'
                    +                    '<select name="dacAppForward" lay-verify="required" id="dacAppForward"></select>'
                    +                '</div>'
                    +                '<button class="layui-btn" data-item="'+tdata.id+'" id="okForward">转发</button>'
                    +           ' </div>'
                    +       ' </div>'
                    +        '<div class="layui-form-item">'
                    +            '<div class="layui-input-block">'
                    +               ' <button class="appOk layui-btn" data-item="'+tdata.id+'">确认</button>'
                    +            '</div>'
                    +        '</div>'
                    +    '</div>'
                    +'</div>'
                    +'</div>' 
                }
                // 详情审批
                $.managerFun({
                    departmentId:tdata.department_id,
                    step:tdata.next_step,
                    applyuserId:tdata.apply_user_id,
                    approvalType:tdata.approval_type,
                    itemId:tdata.id,
                    fun:function(rs,forw,steps){
                        var oplhtml ='';
                        for(var i=0;i<rs.length;i++){
                            oplhtml+='<option value="'+rs[i].id+'">'+rs[i].name+'</option>'
                        }
                        $("#nextDacApp").html(oplhtml); 
                        $("#nextDacApp").attr("data-step",steps);
                        form.render(); 
                        if(forw&&forw.length!=0){
                            var forwHtml ='';
                            for(var i=0;i<forw.length;i++){
                                forwHtml+='<option value="'+forw[i].id+'">'+forw[i].name+'</option>'
                            }
                            $("#dacAppForward").html(forwHtml);
                            form.render(); 
                        }else{
                            $("#dacAppForward").parents('.layui-form-item').remove();
                        }
                        
                        var elem =$(this).parents(tdata.id);
                        var TableID = "outgoTable";
                        $("#approvPop").find(" input[value='2']").prop("checked",true);
                        apprPopFun(elem,popUrl,forwardUrl,TableID);
                    }
                    })
                form.on('radio(approvalYn)', function(data){
                    if(data.value==1){
                        $("#dacAppForward").attr("disabled","disabled");
                        $("#okForward").attr("disabled","disabled").addClass("disabled");
                        form.render();
                    }else if(data.value==2){
                        $("#dacAppForward").removeAttr("disabled");
                        $("#okForward").removeAttr("disabled").removeClass("disabled");
                        form.render();
                    }
                }); 
                //----
                var htmls ='<div class="layui-card" style="min-height:300px">'
                    +'<div class="layui-card-body">'
                            +'<div class="reviewCont layui-card-body layui-form">'
                                +'<div class="layui-form-item">'
                                    +'<div class="layui-inline">'
                                        +'<label class="layui-form-label">申请人：</label>'
                                        +'<div class="layui-input-inline cateID">'
                                            +'<span>'+tdata.apply_user_name+'</span>'
                                        +'</div>'
                                    +'</div>'
                                    +'<div class="layui-inline">'
                                        +'<label class="layui-form-label">申请时间：</label>'
                                        +'<div class="layui-input-inline cateID">'
                                            +'<span>'+tdata.apply_time+'</span>'
                                        +'</div>'
                                    +'</div>'

                                    +'<div class="layui-inline">'
                                        +'<label class="layui-form-label">外出类型：</label>'
                                        +'<div class="layui-input-inline cateID">'
                                            +'<span>'+tdata.go_out_type_desc+'</span>'
                                        +'</div>'
                                    +'</div>'
                                    
                                +'</div>'
                                +'<div class="layui-form-item">'
                                    +'<label class="layui-form-label">外出时长：</label>'
                                    +'<div class="layui-input-block cateID ">'
                                        +'<span>'+$.diffTime(tdata.start_time,tdata.end_time)+' (天)</span>'
                                    +'</div>'
                                +'</div>'
                                +'<div class="layui-form-item">'
                                    +'<label class="layui-form-label">外出时间：</label>'
                                    +'<div class="layui-input-block cateID ">'
                                        +'<span>'+tdata.start_time+'~'+tdata.end_time+'</span>'
                                    +'</div>'
                                +'</div>'
                                +'<div class="layui-form-item">'
                                    +'<label class="layui-form-label">外出原因：</label>'
                                    +'<div class="layui-input-block cateID">'
                                        +'<span>'+tdata.content+'</span>'
                                    +'</div>'
                                +'</div>'
                                +'<div class="layui-form-item">'
                                    +'<label class="layui-form-label">考勤详情：</label>'
                                    +'<div class="layui-input-block cateID" id="kqxqTb">'
                                        +'<table class="layui-table" lay-size="sm"><thead></thead><tbody></tbody></table>'
                                    +'</div>'
                                +'</div>'
                                // +'<div class="layui-form-item">'
                                //     +'<label class="layui-form-label">状态：</label>'
                                //     +'<div class="layui-input-block cateID">'
                                //         +'<span>'+tdata.apply_result_desc +' '+(tdata.is_cancel==1?'<span class="green">(取消请假申请)</span>':'')+'</span>'
                                //     +'</div>'
                                // +'</div>'
                            +'</div>'
                            +'<fieldset class="layui-elem-field">'
                                +'<legend>审批历史</legend>'
                                +'<div class="layui-field-box">'+histry+'</div>'
                            +'</fieldset>'
                            +htmlsAudit
                        +'</div>'
                        +'</div>'
                layer.open({
                    type: 1,
                    title: "外出详情",
                    area:['80%','80%'],
                    content: htmls,
                    success:function(layero,index){
                        forHtmlTable(tdata.start_time,tdata.end_time,$("#kqxqTb"),tdata.apply_user_id);
                    }
                })
                //----
            }
        })
        // 筛选
        $("#outgoSur").on("click",function(){
            var UserName = $("#outgoTit").val();
            var ApprovalResult = $("#outgoSelect").val();

            var  outgoEndItem = $("#outgoEndItem").val();
            var  outgoStartItem = $("#outgoStartItem").val();
    
            outgoTable.reload({
                where: {//记录搜索状态
                    ID:'',
                    ApprovalResult:ApprovalResult,
                    UserName: UserName,
                    StartTime:outgoStartItem,
                    EndTime:outgoEndItem,
                },
                page: {
                    curr: 1 //重新从第 1 页开始
                }
            });
            if (UserName !== "" || ApprovalResult !== "") {
                $("#outgoSurBack").css('display', 'inline-block');
            } else {
                $("#outgoSurBack").css('display', 'none');
            }
        })
        // 返回
        $("#outgoSurBack").on("click",function(){
            outgoTable.reload({
                where:{
                    ID:'',
                },
                page: {
                    curr: 1 //重新从第 1 页开始
                },
                done:function(data){
                    autoFixed($(this.elem[0]).next());
                    
                    for(var i =0; i<data.data.length; i++){
                        if(data.data[i].can_approval==true){
                            $("#danceAppr .layui-table-main tr").eq(i).addClass("ColorPrompt")
                        }else{
                            $("#danceAppr .layui-table-main tr").eq(i).removeClass("ColorPrompt")
                        }
                        
                    }
                    form.render();
                },
            });
            $("#outgoSurBack").css('display', 'none');
        })
    
    }
    // 加班
    var overTimeTableFun=function(){
        var overTimeTable = table.render({
            elem: '#overTimeTable'
            ,url:urls+'/gateway/overtime/approvallist'
            ,contentType: 'application/json',
            content: '<div class="layui-card"><div class="layui-card-body layui-form modify-table-cell"><table lay-filter="overtime-History-table" class="layui-table" id="overtime-History-table"></table></div></div>',
            method: 'post',
            where: tableSub2,
            page: true, //开启分页
            // limits:false,
            limits:[10,20,30,40,50,60,70,80,90,100,200,500,1000,5000],
            toolbar:false,
            loading: true,
            toolbar: '',
            defaultToolbar: ''
            ,text: {
                none: '暂无数据' //默认：无数据。注：该属性为 layui 2.2.5 开始新增
            }
            ,cols: [[
            {field:'depatment_name', minWidth:100, title: '部门'}
            ,{field:'apply_user_name', minWidth:80, title: '姓名'}
            ,{field:'start_time', minWidth:160, title: '开始时间'}
            ,{field:'end_time', title: '结束时间', minWidth: 160}
            ,{
                field:'overtime_type_desc', 
                title: '加班类型', 
                minWidth: 100,
                templet:function(d){
                    return d.overtime_type_desc+' '+(d.is_cancel==1?'<span class="green">(取消中)</span>':d.is_cancel==2?'<span class="green">(已取消)</span>':'')
                }
            }
            ,{
                field:'experience', 
                minWidth:160, 
                title: '加班时长',
                templet:function(d){
                    return $.diffTime(d.start_time,d.end_time)
                }
            }
            ,{field:'apply_time', minWidth:160, title: '申请时间'}
            ,{
                field:'content', 
                minWidth:120, 
                title: '加班原因',
            }
            ,{
                field:'approval_history', 
                minWidth:320, 
                title: '审批意见',
                templet:function(d){
                    var yj='';
                    if(d.approval_history.length==0){
                        yj ='暂无';
                    }else{
                        for(var k=0;k< d.approval_history.length;k++){
                            var res='';
                            var classList = '';
                            if(d.approval_history[k].is_forward ==1){//是转发的
                                res ='--转发-->';
                                yj+='<p>【'+d.approval_history[k].username+''+res+ ''+d.approval_history[k].forward_username+''//名字
                                                //意见
                                        +'<em class='+classList+'> ' +d.approval_history[k].approval_time+'</em>】：'//时间
                                            +d.approval_history[k].content+'</p>'//意见内容

                            }else{//是审批的
                                if(d.approval_history[k].approval_result==1){
                                    res ="未批准";
                                    classList = "red";
                                }else if(d.approval_history[k].approval_result==2){
                                    res ="已批准";
                                    classList = 'green';
                                }
                                yj+='<p><span> 【'+d.approval_history[k].username +'<em class='+classList+'>'+res+' '+d.approval_history[k].approval_time+'</em>'+'】</span>'+d.approval_history[k].content+'</p>'
                        
                            };
                        }
                    }
                    return yj
                }
            }
            ,{
                field:'apply_time', 
                fixed: 'right',
                minWidth:120, 
                title: '操作',
                templet:function(d){
                    return d.can_approval==true?'<a class="layui-btn layui-btn-xs" lay-event="OUTroval">审批</a> <a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>':'<a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>'
                }
            }

            ]],
                request: {
                pageName: 'currentIndex' //页码的参数名称，默认：page
                    ,
                limitName: 'pageSize' //每页数据量的参数名，默认：limit
            },
            parseData: function (res) { //res 即为原始返回的数据
                return {
                    "status_code": res.status_code, //解析接口状态
                    "message": res.message, //解析提示文本
                    "count": res.data.total_count, //解析数据长度
                    "data": res.data.data_list, //解析数据列表
                    "curr": res.data.page_index
                };
            },
            done:function(data){
                autoFixed($(this.elem[0]).next());
                for(var i =0; i<data.data.length; i++){
                    if(data.data[i].can_approval==true){
                        $("#overTimeAppr .layui-table-main tr").eq(i).addClass("ColorPrompt")
                    }else{
                        $("#overTimeAppr .layui-table-main tr").eq(i).removeClass("ColorPrompt")
                    }
                    
                }
                form.render();
                if(tableSub2&&tableSub2.ID&&this.where.ID!=''){
                    $('div#overTimeAppr .layui-table-body.layui-table-main a[lay-event="detail"]').click();
                }
            }
            })
   
        // 弹窗
        table.on('tool(overTimeTable)', function (obj) {
            var tdata = obj.data; //获得当前行数据
            var layEvent = obj.event;
            if(layEvent=="OUTroval"){
                var htmls ='<div class="layui-card">'
                            +'<div class="reviewCont layui-card-body">'
                            +    '<div class="layui-form" action="">'
                            +        '<div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label">审批意见：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<textarea id="appDacText" name="suggestion" class="layui-textarea" cols="50" rows="4" ></textarea>'
                            +            '</div>'
                            +        '</div>'
                            +        '<div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label">是否同意：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalOk" value="2" title="同意" checked>'
                            +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalNo" value="1" title="不同意">'
                            +            '</div>'
                            +        '</div>'
                            +        '<div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label">审批人：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<div class="layui-input-inline">'
                            +                    '<select name="nextDacApp" lay-verify="required" id="nextDacApp"></select>'
                            +                '</div>'
                            +            '</div>'
                            +        '</div>'
                            +       ' <div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label modify-layui-width">选择转交人：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<div class="layui-input-inline MaxHeight">'
                            +                    '<select name="dacAppForward" lay-verify="required" id="dacAppForward"></select>'
                            +                '</div>'
                            +                '<button class="layui-btn" data-item="'+tdata.id+'" id="okForward">转发</button>'
                            +           ' </div>'
                            +       ' </div>'
                            +        '<div class="layui-form-item">'
                            +            '<div class="layui-input-block">'
                            +               ' <button class="appOk layui-btn" data-item="'+tdata.id+'">确认</button>'
                            +            '</div>'
                            +        '</div>'
                            +    '</div>'
                            +'</div>'
                            +'</div>'

                layer.open({
                    title:'审批意见',
                    content:htmls,
                    type:1,
                    id:'approvPop',
                    area:['60%','51%'],
                    success:function(layero,index){
                        form.render(); 
                        $.managerFun({
                            departmentId:tdata.department_id,
                            step:tdata.next_step,
                            applyuserId:tdata.apply_user_id,
                            approvalType:tdata.approval_type,
                            itemId:tdata.id,
                            fun:function(rs,forw,steps){
                                var oplhtml ='';
                                for(var i=0;i<rs.length;i++){
                                    oplhtml+='<option value="'+rs[i].id+'">'+rs[i].name+'</option>'
                                }
                                $("#nextDacApp").html(oplhtml); 
                                $("#nextDacApp").attr("data-step",steps);
                                form.render(); 
                                if(forw&&forw.length!=0){
                                    var forwHtml ='';
                                    for(var i=0;i<forw.length;i++){
                                        forwHtml+='<option value="'+forw[i].id+'">'+forw[i].name+'</option>'
                                    }
                                    $("#dacAppForward").html(forwHtml);
                                    form.render(); 
                                }else{
                                    $("#dacAppForward").parents('.layui-form-item').remove();
                                }
                                
                                var elem =$(this).parents(tdata.id);
                                var TableID = "overTimeTable";
                                $("#approvPop").find(" input[value='2']").prop("checked",true);
                                apprPopFun(elem,popUrl,forwardUrl,TableID);
                            }
                            })
                        form.on('radio(approvalYn)', function(data){
                            if(data.value==1){
                                $("#dacAppForward").attr("disabled","disabled");
                                $("#okForward").attr("disabled","disabled").addClass("disabled");
                                form.render();
                            }else if(data.value==2){
                                $("#dacAppForward").removeAttr("disabled");
                                $("#okForward").removeAttr("disabled").removeClass("disabled");
                                form.render();
                            }
                        });  
                    }
                })
            }else if(layEvent=="detail"){
                var histry = '';
                if (tdata.approval_history.length > 0) {
                    for (var k = 0; k < tdata.approval_history.length; k++) {
                        var res = '';
                        var classList = '';
                        if (tdata.approval_history[k].is_forward == 1) { //是转发的
                            res = '--转发-->';

                            histry += '<p>【' + tdata.approval_history[k].username + '' + res + '' + tdata.approval_history[k].forward_username + '' //名字
                                //意见

                                +
                                '<em class=' + classList + '> ' +
                                tdata.approval_history[k].approval_time + '</em>】：<span class="list" title=' + tdata.approval_history[k].content + '>' //时间
                                +
                                tdata.approval_history[k].content + '</p>' //意见内容

                        } else { //是审批的

                            if (tdata.approval_history[k].approval_result == 1) {
                                res = '未通过';
                                classList = "red";
                            } else if (tdata.approval_history[k].approval_result == 2) {
                                res = '已通过';
                                classList = "green";
                            }

                            histry += '<p>【' + tdata.approval_history[k].username + '<em class=' + classList + '>' //名字
                                +
                                res + '' //意见
                                +
                                tdata.approval_history[k].approval_time + '</em>】：<span class="list" title=' + tdata.approval_history[k].content + '>' //时间
                                +
                                tdata.approval_history[k].content + '</p>' //意见内容
                        }
                    }
                } else {
                    histry = "暂无审批记录"
                }

                var htmlsAudit=''
                if(tdata.can_approval==true){
                    htmlsAudit ='<div class="layui-card" id="approvPop">'
                    +'<div class="reviewCont layui-card-body">'
                    +    '<div class="layui-form" action="">'
                    +        '<div class="layui-form-item">'
                    +            '<label class="layui-form-label modify-layui-label">审批意见：</label>'
                    +            '<div class="layui-input-block">'
                    +                '<textarea id="appDacText" name="suggestion" class="layui-textarea" cols="50" rows="4" ></textarea>'
                    +            '</div>'
                    +        '</div>'
                    +        '<div class="layui-form-item">'
                    +            '<label class="layui-form-label modify-layui-label">是否同意：</label>'
                    +            '<div class="layui-input-block">'
                    +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalOk" value="2" title="同意" checked>'
                    +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalNo" value="1" title="不同意">'
                    +            '</div>'
                    +        '</div>'
                    +        '<div class="layui-form-item">'
                    +            '<label class="layui-form-label modify-layui-label">审批人：</label>'
                    +            '<div class="layui-input-block">'
                    +                '<div class="layui-input-inline">'
                    +                    '<select name="nextDacApp" lay-verify="required" id="nextDacApp"></select>'
                    +                '</div>'
                    +            '</div>'
                    +        '</div>'
                    +       ' <div class="layui-form-item">'
                    +            '<label class="layui-form-label modify-layui-label modify-layui-width">选择转交人：</label>'
                    +            '<div class="layui-input-block">'
                    +                '<div class="layui-input-inline MaxHeight">'
                    +                    '<select name="dacAppForward" lay-verify="required" id="dacAppForward"></select>'
                    +                '</div>'
                    +                '<button class="layui-btn" data-item="'+tdata.id+'" id="okForward">转发</button>'
                    +           ' </div>'
                    +       ' </div>'
                    +        '<div class="layui-form-item">'
                    +            '<div class="layui-input-block">'
                    +               ' <button class="appOk layui-btn" data-item="'+tdata.id+'">确认</button>'
                    +            '</div>'
                    +        '</div>'
                    +    '</div>'
                    +'</div>'
                    +'</div>' 
                }
                // 详情审批
                $.managerFun({
                    departmentId:tdata.department_id,
                    step:tdata.next_step,
                    applyuserId:tdata.apply_user_id,
                    approvalType:tdata.approval_type,
                    itemId:tdata.id,
                    fun:function(rs,forw,steps){
                        var oplhtml ='';
                        for(var i=0;i<rs.length;i++){
                            oplhtml+='<option value="'+rs[i].id+'">'+rs[i].name+'</option>'
                        }
                        $("#nextDacApp").html(oplhtml); 
                        $("#nextDacApp").attr("data-step",steps);
                        form.render(); 
                        if(forw&&forw.length!=0){
                            var forwHtml ='';
                            for(var i=0;i<forw.length;i++){
                                forwHtml+='<option value="'+forw[i].id+'">'+forw[i].name+'</option>'
                            }
                            $("#dacAppForward").html(forwHtml);
                            form.render(); 
                        }else{
                            $("#dacAppForward").parents('.layui-form-item').remove();
                        }
                        
                        var elem =$(this).parents(tdata.id);
                        var TableID = "overTimeTable";
                        $("#approvPop").find(" input[value='2']").prop("checked",true);
                        apprPopFun(elem,popUrl,forwardUrl,TableID);
                    }
                    })
                form.on('radio(approvalYn)', function(data){
                    if(data.value==1){
                        $("#dacAppForward").attr("disabled","disabled");
                        $("#okForward").attr("disabled","disabled").addClass("disabled");
                        form.render();
                    }else if(data.value==2){
                        $("#dacAppForward").removeAttr("disabled");
                        $("#okForward").removeAttr("disabled").removeClass("disabled");
                        form.render();
                    }
                }); 
                
                var htmls ='<div class="layui-card" style="min-height:300px">'
                    +'<div class="layui-card-body">'
                            +'<div class="reviewCont layui-card-body layui-form">'
                                +'<div class="layui-form-item">'
                                    +'<div class="layui-inline">'
                                        +'<label class="layui-form-label">申请人：</label>'
                                        +'<div class="layui-input-inline cateID">'
                                            +'<span>'+tdata.apply_user_name+'</span>'
                                        +'</div>'
                                    +'</div>'
                                    +'<div class="layui-inline">'
                                        +'<label class="layui-form-label">申请时间：</label>'
                                        +'<div class="layui-input-inline cateID">'
                                            +'<span>'+tdata.apply_time+'</span>'
                                        +'</div>'
                                    +'</div>'

                                    +'<div class="layui-inline">'
                                        +'<label class="layui-form-label">加班类型：</label>'
                                        +'<div class="layui-input-inline cateID">'
                                            +'<span>'+tdata.overtime_type_desc+'</span>'
                                        +'</div>'
                                    +'</div>'
                                    
                                +'</div>'
                                +'<div class="layui-form-item">'
                                    +'<label class="layui-form-label">加班时长：</label>'
                                    +'<div class="layui-input-block cateID ">'
                                        +'<span>'+$.diffTime(tdata.start_time,tdata.end_time)+' (天)</span>'
                                    +'</div>'
                                +'</div>'
                                +'<div class="layui-form-item">'
                                    +'<label class="layui-form-label">加班时间：</label>'
                                    +'<div class="layui-input-block cateID ">'
                                        +'<span>'+tdata.start_time+'~'+tdata.end_time+'</span>'
                                    +'</div>'
                                +'</div>'
                                +'<div class="layui-form-item">'
                                    +'<label class="layui-form-label">加班原因：</label>'
                                    +'<div class="layui-input-block cateID">'
                                        +'<span>'+tdata.content+'</span>'
                                    +'</div>'
                                +'</div>'
                                +'<div class="layui-form-item">'
                                    +'<label class="layui-form-label">考勤详情：</label>'
                                    +'<div class="layui-input-block cateID" id="kqxqTb">'
                                        +'<table class="layui-table" lay-size="sm"><thead></thead><tbody></tbody></table>'
                                    +'</div>'
                                +'</div>'
                                // +'<div class="layui-form-item">'
                                //     +'<label class="layui-form-label">状态：</label>'
                                //     +'<div class="layui-input-block cateID">'
                                //         +'<span>'+tdata.apply_result_desc +' '+(tdata.is_cancel==1?'<span class="green">(取消请假申请)</span>':'')+'</span>'
                                //     +'</div>'
                                // +'</div>'
                            +'</div>'
                            +'<fieldset class="layui-elem-field">'
                                +'<legend>审批历史</legend>'
                                +'<div class="layui-field-box">'+histry+'</div>'
                            +'</fieldset>'
                            +htmlsAudit
                        +'</div>'
                        +'</div>'
                layer.open({
                    type: 1,
                    title: "加班详情",
                    area: ['80%','80%'],
                    content: htmls,
                    success:function(layero,index){
                        forHtmlTable(tdata.start_time,tdata.end_time,$("#kqxqTb"),tdata.apply_user_id);

                    }
                })
            }
        })
        // 筛选
        $("#overTime").on("click",function(){
            var UserName = $("#overTimeTit").val();
            var ApprovalResult = $("#overTimeSelect").val();
            var  overTimeEndItem = $("#overTimeEndItem").val();
            var  overTimeStartItem = $("#overTimeStartItem").val();
    
            overTimeTable.reload({
                where: {//记录搜索状态
                    ID:'',
                    ApprovalResult:ApprovalResult,
                    UserName: UserName,
                    StartTime:overTimeStartItem,
                    EndTime:overTimeEndItem,
                },
                page: {
                    curr: 1 //重新从第 1 页开始
                },
                done:function(data){
                    autoFixed($(this.elem[0]).next());
                    
                    for(var i =0; i<data.data.length; i++){
                        if(data.data[i].can_approval==true){
                            $("#danceAppr .layui-table-main tr").eq(i).addClass("ColorPrompt")
                        }else{
                            $("#danceAppr .layui-table-main tr").eq(i).removeClass("ColorPrompt")
                        }
                        
                    }
                    form.render();
                },
            });
            if (UserName !== "" || ApprovalResult !== "") {
                $("#overTimeBack").css('display', 'inline-block');
            } else {
                $("#overTimeBack").css('display', 'none');
            }
        })
        // 返回
        $("#overTimeBack").on("click",function(){
            overTimeTable.reload({
                where:{
                    ID:'',
                },
                page: {
                    curr: 1 //重新从第 1 页开始
                }
                ,done:function(data){
                    autoFixed($(this.elem[0]).next());
                    
                    for(var i =0; i<data.data.length; i++){
                        if(data.data[i].can_approval==true){
                            $("#danceAppr .layui-table-main tr").eq(i).addClass("ColorPrompt")
                        }else{
                            $("#danceAppr .layui-table-main tr").eq(i).removeClass("ColorPrompt")
                        }
                        
                    }
                    form.render();
                },
            });
            $("#overTimeBack").css('display', 'none');
        })
    }
   // 补录
    var danceTableFun=function(){
        var danceTable = table.render({
            elem: '#danceTable'
            ,url:urls+'/gateway/checkinoutapply/approvallist'
            ,contentType: 'application/json',
            content: '<div class="layui-card"><div class="layui-card-body layui-form modify-table-cell"><table lay-filter="overtime-History-table" class="layui-table" id="overtime-History-table"></table></div></div>',
            method: 'post',
            where: tableSub3,
            page: true, //开启分页
            // limits:false,
            limits:[10,20,30,40,50,60,70,80,90,100,200,500,1000,5000],
            toolbar:false,
            loading: true,
            toolbar: '',
            defaultToolbar: ''
            ,text: {
                none: '暂无数据' //默认：无数据。注：该属性为 layui 2.2.5 开始新增
            }
            ,cols: [[
            {field:'depatment_name', minWidth:100, title: '部门'}
            ,{field:'apply_user_name', minWidth:80, title: '姓名'}
            ,{
                field:'check_in_out_time', 
                minWidth:160, 
                title: '补录时间',
                templet:function(d){
                    var arr= d.check_in_out_time.split("|");
                    var arrHtml='';
                    for(var k=0;k<arr.length;k++){
                        arrHtml+='<p>'+arr[k]+'</p>'
                    }
                    return arrHtml
                }
            }
            ,{field:'apply_time', minWidth:160, title: '申请时间'}
            ,{field:'content', minWidth:160, title: '补录原因'}
            ,{
                field:'approval_history', 
                minWidth:320, 
                title: '审批意见',
                templet:function(d){
                    var yj='';
                    if(d.approval_history.length==0){
                        yj ='暂无';
                    }else{
                        for(var k=0;k< d.approval_history.length;k++){
                            var res='';
                            var classList = '';
                            if(d.approval_history[k].is_forward ==1){//是转发的
                                res ='--转发-->';
                                yj+='<p>【'+d.approval_history[k].username+''+res+ ''+d.approval_history[k].forward_username+''//名字
                                                //意见
                                        +'<em class='+classList+'> ' +d.approval_history[k].approval_time+'</em>】：'//时间
                                            +d.approval_history[k].content+'</p>'//意见内容

                            }else{//是审批的
                                if(d.approval_history[k].approval_result==1){
                                    res ="未批准";
                                    classList = "red";
                                }else if(d.approval_history[k].approval_result==2){
                                    res ="已批准";
                                    classList = 'green';
                                }
                                yj+='<p><span> 【'+d.approval_history[k].username +'<em class='+classList+'>'+res+' '+d.approval_history[k].approval_time+'</em>'+'】</span>'+d.approval_history[k].content+'</p>'
                        
                            };
                        }
                    }
                    return yj
                }
            }
            ,{
                field:'apply_time', 
                fixed: 'right',
                minWidth:120, 
                title: '操作',
                templet:function(d){
                    return d.can_approval==true?'<a class="layui-btn layui-btn-xs" lay-event="OUTroval">审批</a> <a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>':'<a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>'
                }
            }

            ]],
                request: {
                pageName: 'currentIndex' //页码的参数名称，默认：page
                    ,
                limitName: 'pageSize' //每页数据量的参数名，默认：limit
            },
            parseData: function (res) { //res 即为原始返回的数据
                return {
                    "status_code": res.status_code, //解析接口状态
                    "message": res.message, //解析提示文本
                    "count": res.data.total_count, //解析数据长度
                    "data": res.data.data_list, //解析数据列表
                    "curr": res.data.page_index
                };
            },
            done:function(data){
                autoFixed($(this.elem[0]).next());
                for(var i =0; i<data.data.length; i++){
                    if(data.data[i].can_approval==true){
                        $("#danceAppr .layui-table-main tr").eq(i).addClass("ColorPrompt")
                    }else{
                        $("#danceAppr .layui-table-main tr").eq(i).removeClass("ColorPrompt")
                    }
                    
                }
                form.render();
                if(tableSub3&&tableSub3.ID&&this.where.ID!=''){
                    $('div#danceAppr .layui-table-body.layui-table-main a[lay-event="detail"]').click();
                }
            }
        })
  
        // 弹窗
        table.on('tool(danceTable)', function (obj) {
            var tdata = obj.data; //获得当前行数据
            var layEvent = obj.event;
            if(layEvent=="OUTroval"){
                var htmls ='<div class="layui-card">'
                            +'<div class="reviewCont layui-card-body">'
                            +    '<div class="layui-form" action="">'
                            +        '<div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label">审批意见：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<textarea id="appDacText" name="suggestion" class="layui-textarea" cols="50" rows="4" ></textarea>'
                            +            '</div>'
                            +        '</div>'
                            +        '<div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label">是否同意：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalOk" value="2" title="同意" checked>'
                            +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalNo" value="1" title="不同意">'
                            +            '</div>'
                            +        '</div>'
                            +        '<div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label">审批人：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<div class="layui-input-inline">'
                            +                    '<select name="nextDacApp" lay-verify="required" id="nextDacApp"></select>'
                            +                '</div>'
                            +            '</div>'
                            +        '</div>'
                            +       ' <div class="layui-form-item">'
                            +            '<label class="layui-form-label modify-layui-label modify-layui-width">选择转交人：</label>'
                            +            '<div class="layui-input-block">'
                            +                '<div class="layui-input-inline MaxHeight">'
                            +                    '<select name="dacAppForward" lay-verify="required" id="dacAppForward"></select>'
                            +                '</div>'
                            +                '<button class="layui-btn" data-item="'+tdata.id+'" id="okForward">转发</button>'
                            +           ' </div>'
                            +       ' </div>'
                            +        '<div class="layui-form-item">'
                            +            '<div class="layui-input-block">'
                            +               ' <button class="appOk layui-btn" data-item="'+tdata.id+'">确认</button>'
                            +            '</div>'
                            +        '</div>'
                            +    '</div>'
                            +'</div>'
                            +'</div>'

                layer.open({
                    title:'审批意见',
                    content:htmls,
                    type:1,
                    id:'approvPop',
                    area:['60%','51%'],
                    success:function(layero,index){
                        form.render(); 
                        $.managerFun({
                            departmentId:tdata.department_id,
                            step:tdata.next_step,
                            applyuserId:tdata.apply_user_id,
                            approvalType:tdata.approval_type,
                            itemId:tdata.id,
                            fun:function(rs,forw,steps){
                                var oplhtml ='';
                                for(var i=0;i<rs.length;i++){
                                    oplhtml+='<option value="'+rs[i].id+'">'+rs[i].name+'</option>'
                                }
                                $("#nextDacApp").html(oplhtml); 
                                $("#nextDacApp").attr("data-step",steps);
                                form.render(); 
                                if(forw&&forw.length!=0){
                                    var forwHtml ='';
                                    for(var i=0;i<forw.length;i++){
                                        forwHtml+='<option value="'+forw[i].id+'">'+forw[i].name+'</option>'
                                    }
                                    $("#dacAppForward").html(forwHtml);
                                    form.render(); 
                                }else{
                                    $("#dacAppForward").parents('.layui-form-item').remove();
                                }
                                
                                var elem =$(this).parents(tdata.id);
                                var TableID = "danceTable";
                                $("#approvPop").find(" input[value='2']").prop("checked",true);
                                apprPopFun(elem,popUrl,forwardUrl,TableID);
                            }
                            })
                        form.on('radio(approvalYn)', function(data){
                            if(data.value==1){
                                $("#dacAppForward").attr("disabled","disabled");
                                $("#okForward").attr("disabled","disabled").addClass("disabled");
                                form.render();
                            }else if(data.value==2){
                                $("#dacAppForward").removeAttr("disabled");
                                $("#okForward").removeAttr("disabled").removeClass("disabled");
                                form.render();
                            }
                        });  
                    }
                })
            }else if(layEvent=="detail"){
                // <a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>
                var histry = '';
                if (tdata.approval_history.length > 0) {
                    for (var k = 0; k < tdata.approval_history.length; k++) {
                        var res = '';
                        var classList = '';
                        if (tdata.approval_history[k].is_forward == 1) { //是转发的
                            res = '--转发-->';

                            histry += '<p>【' + tdata.approval_history[k].username + '' + res + '' + tdata.approval_history[k].forward_username + '' //名字
                                //意见

                                +
                                '<em class=' + classList + '> ' +
                                tdata.approval_history[k].approval_time + '</em>】：<span class="list" title=' + tdata.approval_history[k].content + '>' //时间
                                +
                                tdata.approval_history[k].content + '</p>' //意见内容

                        } else { //是审批的

                            if (tdata.approval_history[k].approval_result == 1) {
                                res = '未通过';
                                classList = "red";
                            } else if (tdata.approval_history[k].approval_result == 2) {
                                res = '已通过';
                                classList = "green";
                            }

                            histry += '<p>【' + tdata.approval_history[k].username + '<em class=' + classList + '>' //名字
                                +
                                res + '' //意见
                                +
                                tdata.approval_history[k].approval_time + '</em>】：<span class="list" title=' + tdata.approval_history[k].content + '>' //时间
                                +
                                tdata.approval_history[k].content + '</p>' //意见内容
                        }
                    }
                } else {
                    histry = "暂无审批记录"
                }
                var htmlsAudit=''
                if(tdata.can_approval==true){
                    htmlsAudit ='<div class="layui-card" id="approvPop">'
                    +'<div class="reviewCont layui-card-body">'
                    +    '<div class="layui-form" action="">'
                    +        '<div class="layui-form-item">'
                    +            '<label class="layui-form-label modify-layui-label">审批意见：</label>'
                    +            '<div class="layui-input-block">'
                    +                '<textarea id="appDacText" name="suggestion" class="layui-textarea" cols="50" rows="4" ></textarea>'
                    +            '</div>'
                    +        '</div>'
                    +        '<div class="layui-form-item">'
                    +            '<label class="layui-form-label modify-layui-label">是否同意：</label>'
                    +            '<div class="layui-input-block">'
                    +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalOk" value="2" title="同意" checked>'
                    +                '<input type="radio"  lay-filter="approvalYn" name="approvalYn" id="approvalNo" value="1" title="不同意">'
                    +            '</div>'
                    +        '</div>'
                    +        '<div class="layui-form-item">'
                    +            '<label class="layui-form-label modify-layui-label">审批人：</label>'
                    +            '<div class="layui-input-block">'
                    +                '<div class="layui-input-inline">'
                    +                    '<select name="nextDacApp" lay-verify="required" id="nextDacApp"></select>'
                    +                '</div>'
                    +            '</div>'
                    +        '</div>'
                    +       ' <div class="layui-form-item">'
                    +            '<label class="layui-form-label modify-layui-label modify-layui-width">选择转交人：</label>'
                    +            '<div class="layui-input-block">'
                    +                '<div class="layui-input-inline MaxHeight">'
                    +                    '<select name="dacAppForward" lay-verify="required" id="dacAppForward"></select>'
                    +                '</div>'
                    +                '<button class="layui-btn" data-item="'+tdata.id+'" id="okForward">转发</button>'
                    +           ' </div>'
                    +       ' </div>'
                    +        '<div class="layui-form-item">'
                    +            '<div class="layui-input-block">'
                    +               ' <button class="appOk layui-btn" data-item="'+tdata.id+'">确认</button>'
                    +            '</div>'
                    +        '</div>'
                    +    '</div>'
                    +'</div>'
                    +'</div>' 
                }
                // 详情审批
                $.managerFun({
                    departmentId:tdata.department_id,
                    step:tdata.next_step,
                    applyuserId:tdata.apply_user_id,
                    approvalType:tdata.approval_type,
                    itemId:tdata.id,
                    fun:function(rs,forw,steps){
                        var oplhtml ='';
                        for(var i=0;i<rs.length;i++){
                            oplhtml+='<option value="'+rs[i].id+'">'+rs[i].name+'</option>'
                        }
                        $("#nextDacApp").html(oplhtml); 
                        $("#nextDacApp").attr("data-step",steps);
                        form.render(); 
                        if(forw&&forw.length!=0){
                            var forwHtml ='';
                            for(var i=0;i<forw.length;i++){
                                forwHtml+='<option value="'+forw[i].id+'">'+forw[i].name+'</option>'
                            }
                            $("#dacAppForward").html(forwHtml);
                            form.render(); 
                        }else{
                            $("#dacAppForward").parents('.layui-form-item').remove();
                        }
                        
                        var elem =$(this).parents(tdata.id);
                        var TableID = "danceTable";
                        $("#approvPop").find(" input[value='2']").prop("checked",true);
                        apprPopFun(elem,popUrl,forwardUrl,TableID);
                    }
                    })
                form.on('radio(approvalYn)', function(data){
                    if(data.value==1){
                        $("#dacAppForward").attr("disabled","disabled");
                        $("#okForward").attr("disabled","disabled").addClass("disabled");
                        form.render();
                    }else if(data.value==2){
                        $("#dacAppForward").removeAttr("disabled");
                        $("#okForward").removeAttr("disabled").removeClass("disabled");
                        form.render();
                    }
                }); 

                var htmls ='<div class="layui-card" style="min-height:300px">'
                    +'<div class="layui-card-body">'
                            +'<div class="reviewCont layui-card-body layui-form">'
                                +'<div class="layui-form-item">'
                                    +'<div class="layui-inline">'
                                        +'<label class="layui-form-label">申请人：</label>'
                                        +'<div class="layui-input-inline cateID">'
                                            +'<span>'+tdata.apply_user_name+'</span>'
                                        +'</div>'
                                    +'</div>'
                                    +'<div class="layui-inline">'
                                        +'<label class="layui-form-label">申请时间：</label>'
                                        +'<div class="layui-input-inline cateID">'
                                            +'<span>'+tdata.apply_time+'</span>'
                                        +'</div>'
                                    +'</div>'

                                    // +'<div class="layui-inline">'
                                    //     +'<label class="layui-form-label">补录类型：</label>'
                                    //     +'<div class="layui-input-inline cateID">'
                                    //         +'<span>'+tdata.overtime_type_desc+'</span>'
                                    //     +'</div>'
                                    // +'</div>'
                                    
                                +'</div>'
                                // +'<div class="layui-form-item">'
                                //     +'<label class="layui-form-label">补录时长：</label>'
                                //     +'<div class="layui-input-block cateID ">'
                                //         +'<span>'+$.diffTime(tdata.start_time,tdata.end_time)+' (天)</span>'
                                //     +'</div>'
                                // +'</div>'
                                +'<div class="layui-form-item">'
                                    +'<label class="layui-form-label">补录时间：</label>'
                                    +'<div class="layui-input-block cateID ">'
                                        +'<span>'+tdata.check_in_out_time+'</span>'
                                    +'</div>'
                                +'</div>'
                                +'<div class="layui-form-item">'
                                    +'<label class="layui-form-label">补录原因：</label>'
                                    +'<div class="layui-input-block cateID">'
                                        +'<span>'+tdata.content+'</span>'
                                    +'</div>'
                                +'</div>'
                            +'</div>'
                            +'<fieldset class="layui-elem-field">'
                                +'<legend>审批历史</legend>'
                                +'<div class="layui-field-box">'+histry+'</div>'
                            +'</fieldset>'
                            +htmlsAudit
                        +'</div>'
                        +'</div>'
                layer.open({
                    type: 1,
                    title: "补录详情",
                    area: ['auto'],
                    content: htmls,
                    success:function(layero,index){

                    }
                })
            }
        })
        // 筛选
        $("#danceSur").on("click",function(){
            var UserName = $("#danceTit").val();
            var ApprovalResult = $("#danceSelect").val();

            var danceEndItem = $("#danceEndItem").val();
            var danceStartItem = $("#danceStartItem").val();
            danceTable.reload({
                where: {//记录搜索状态
                    ID:'',
                    ApprovalResult:ApprovalResult,
                    UserName: UserName,
                    StartTime:danceStartItem,
                    EndTime:danceEndItem,
                },
                page: {
                    curr: 1 //重新从第 1 页开始
                },
                done:function(data){
                    autoFixed($(this.elem[0]).next());
                    
                    for(var i =0; i<data.data.length; i++){
                        if(data.data[i].can_approval==true){
                            $("#danceAppr .layui-table-main tr").eq(i).addClass("ColorPrompt")
                        }else{
                            $("#danceAppr .layui-table-main tr").eq(i).removeClass("ColorPrompt")
                        }
                        
                    }
                    form.render();
                }
            });
            if (UserName !== "" || ApprovalResult !== "") {
                $("#danceSurBack").css('display', 'inline-block');
            } else {
                $("#danceSurBack").css('display', 'none');
            }
        })
        // 返回
        $("#danceSurBack").on("click",function(){
            danceTable.reload({
                where:{ID:'',},
                done:function(data){
                    autoFixed($(this.elem[0]).next());
                    
                    for(var i =0; i<data.data.length; i++){
                        if(data.data[i].can_approval==true){
                            $("#danceAppr .layui-table-main tr").eq(i).addClass("ColorPrompt")
                        }else{
                            $("#danceAppr .layui-table-main tr").eq(i).removeClass("ColorPrompt")
                        }
                        
                    }
                    form.render();
                },
                page: {
                    curr: 1 //重新从第 1 页开始
                }
            });
            $("#danceSurBack").css('display', 'none');
        })


    }
    var tabFun=function(tabIndex){
        var tabIndex = parseFloat(tabIndex)
        switch(tabIndex)
                {
                case 0:
                    $.fetch({
                        url:"/gateway/userleave/leavetypes",
                        type: 'post',
                        cb:function(rs){
                            leavetypes=rs;
                            // popUrl = "/gateway/userleave/approval";
                            // forwardUrl="/gateway/userleave/forward";
                            // leaveTable()
                             //请假
                             leaveTable = table.render({
                                elem: '#leaveTable'
                                ,url:urls+'/gateway/userleave/approvallist'
                                ,contentType: 'application/json',
                                content: '<div class="layui-card"><div class="layui-card-body layui-form modify-table-cell"><table lay-filter="overtime-History-table" class="layui-table" id="overtime-History-table"></table></div></div>',
                                method: 'post',
                                where: tableSub0,
                                page: true, //开启分页
                                // limits:false,
                                limits:[10,20,30,40,50,60,70,80,90,100,200,500,1000,5000],
                                toolbar:false,
                                loading: true,
                                toolbar: '',
                                defaultToolbar: ''
                                ,text: {
                                    none: '暂无数据' //默认：无数据。注：该属性为 layui 2.2.5 开始新增
                                }
                                ,cols: [[
                                {field:'depatment_name', minWidth:100, title: '部门'}
                                ,{field:'apply_user_name', minWidth:80, title: '姓名'}
                                ,{field:'day_count', minWidth:100, title: '请假天数'}
                                ,{field:'start_time', minWidth:160, title: '开始时间'}
                                ,{field:'end_time', title: '结束时间', minWidth: 160}
                                ,{
                                    field:'experience', 
                                    minWidth:130, 
                                    title: '请假类型',
                                    templet:function(d){
                                        return leavetypes[d.leave_type]+''+(d.is_cancel==1?'(取消申请)':'')
                                    }
                                }
                                ,{field:'apply_time', minWidth:160, title: '申请时间'}
                                ,{field:'content', minWidth:100, title: '请假原因：'}
                                ,{
                                    field:'approval_history', 
                                    minWidth:320, 
                                    title: '审批意见',
                                    templet:function(d){
                                        var yj='';
                                        if(d.approval_history.length==0){
                                            yj ='暂无';
                                        }else{
                                            for(var k=0;k< d.approval_history.length;k++){
                                                var res='';
                                                var classList = '';
                                                if(d.approval_history[k].is_forward ==1){//是转发的
                                                    res ='--转发-->';
                                                    yj+='<p>【'+d.approval_history[k].username+''+res+ ''+d.approval_history[k].forward_username+''//名字
                                                                    //意见
                                                            +'<em class='+classList+'> ' +d.approval_history[k].approval_time+'</em>】：'//时间
                                                                +d.approval_history[k].content+'</p>'//意见内容

                                                }else{//是审批的
                                                    if(d.approval_history[k].approval_result==1){
                                                        res ="未批准";
                                                        classList = "red";
                                                    }else if(d.approval_history[k].approval_result==2){
                                                        res ="已批准";
                                                        classList = 'green';
                                                    }
                                                    yj+='<p><span> 【'+d.approval_history[k].username +'<em class='+classList+'>'+res+' '+d.approval_history[k].approval_time+'</em>'+'】</span>'+d.approval_history[k].content+'</p>'
                                                }
                                            
                                            };
                                        }
                                        return yj
                                    }
                                }
                                ,{
                                    field:'apply_time', 
                                    minWidth:120, 
                                    title: '附件',
                                    templet:function(d){
                                        var attachesArr =d.attaches;
                                        var attach='暂无附件';
                                        if(attachesArr&&attachesArr.length>0){
                                            attach='';
                                            for(var j=0;j<attachesArr.length;j++){
                                                attach+='<a title="点击下载" class="seeXqOutIn" target="_blank" href="/gateway/userleave/download/'+attachesArr[j].id+'" >'+attachesArr[j].original_name+'</a>'
                                            }
                                        }
                                        return attach
                                    }
                                }
                                ,{
                                    field:'apply_time', 
                                    fixed: 'right',
                                    minWidth:120, 
                                    title: '操作',
                                    templet:function(d){
                                        return d.can_approval==true?'<a class="layui-btn layui-btn-xs" lay-event="Approval">审批</a> <a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>':'<a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>'
                                    }
                                }

                                ]],
                                request: {
                                    pageName: 'currentIndex' //页码的参数名称，默认：page
                                    ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
                                },
                                parseData: function (res) { //res 即为原始返回的数据
                                    return {
                                        "status_code": res.status_code, //解析接口状态
                                        "message": res.message, //解析提示文本
                                        "count": res.data.total_count, //解析数据长度
                                        "data": res.data.data_list, //解析数据列表
                                        "curr": res.data.page_index
                                    };
                                },
                                done:function(data){
                                    autoFixed($(this.elem[0]).next());
                                    for(var i =0; i<data.data.length; i++){
                                        if(data.data[i].can_approval==true){
                                            $("#leaveAppr .layui-table-main tr").eq(i).addClass("ColorPrompt")
                                        }else{
                                            $("#leaveAppr .layui-table-main tr").eq(i).removeClass("ColorPrompt")
                                        }
                                        
                                    }
                                    $("#SurveyTit").val(this.where.UserName);
                                    $("#leaveSelect").val(this.where.ApprovalResult);
                                    form.render();
                                    if(tableSub0&&tableSub0.ID&&this.where.ID!=''){
                                        $('div#leaveAppr .layui-table-body.layui-table-main a[lay-event="detail"]').click();
                                    }
                                }
                            })
                        }
                    });
                    popUrl = "/gateway/userleave/approval";
                    forwardUrl="/gateway/userleave/forward";
                    // leaveTable();
                    break;

                case 1:
                    popUrl = "/gateway/goout/approval";
                    forwardUrl="/gateway/goout/forward";
                    // outgoTable();
                    outgoTableFun();
                    break;

                case 2:
                    popUrl = "/gateway/overtime/approval";
                    forwardUrl="/gateway/overtime/forward";
                    // overTimeTable();
                    overTimeTableFun();
                    break;

                case 3:
                    popUrl = "/gateway/checkinoutapply/approval";
                    forwardUrl="/gateway/checkinoutapply/forward";
                    // danceTable();
                    danceTableFun();
                    break;

                }
    }
    if(tabId){
        element.tabChange('approval-tabs-brief', tabId);
        tabFun(tabId-1);
    }else{
        tabFun(0)
        var tableSub0={
        
        }
        var tableSub1={
        
        }
        var tableSub2={
        
        }
        var tableSub3={
        
        }
    }
        
        element.on('tab(approval-tabs-brief)', function(obj){
            var tabIndex =obj.index;
            tableSub0={
               
            }
            tableSub1={
               
            }
            tableSub2={
               
            }
            tableSub3={
               
            }
            tabFun(tabIndex)
        });
    //审核弹窗
    var apprPopFun=function(elem,url,furl,TableID){
       
        //选择不同意所需 请勿删除
        var slectHtml=$("#nextDacApp").html();
        $("#approvPop").off("change").on("change","input[name='approvalYn']",function(){
            var vals =$("#approvPop").find(" input[name='approvalYn']:checked").val();
           if(vals ==1){
                $("#nextDacApp").html('<option value="0">无</option>');
           }else{
                $("#nextDacApp").html(slectHtml);
           }
        })
        $("#approvPop .appOk").off("click").on("click",function(){// 接口参数,删除的table item
            var itemID = $(this).attr("data-item");
            var nextApprovalUserID = $("#approvPop #nextDacApp").val();
            var isAgree = $("#approvPop").find(" input[name='approvalYn']:checked").val();
            var content = $("#appDacText").val();
            var nextApprovalStep =$("#approvPop #nextDacApp").attr('data-step');
            if(content==''){
                layer.msg("意见不能为空!");
                return false
            }
            $.fetch({
                url:url,
                type: 'post',
                data:{
                    ItemID:itemID,
                    NextApprovalUserID:nextApprovalUserID,
                    NextApprovalStep:nextApprovalStep,
                    IsAgree:isAgree,
                    Content:content,
                },
                cb:function(rs){
                    layer.closeAll();
                    tableSub={};
                    table.reload(TableID,{
                        where:{},
                        done:function(data){
                            autoFixed($(this.elem[0]).next());
                            
                            for(var i =0; i<data.data.length; i++){
                                if(data.data[i].can_approval==true){
                                    $("#danceAppr .layui-table-main tr").eq(i).addClass("ColorPrompt")
                                }else{
                                    $("#danceAppr .layui-table-main tr").eq(i).removeClass("ColorPrompt")
                                }
                                
                            }
                            form.render();
                        }
                    })
                    layer.msg("审批完成");
                }
            })
        })

        $("#okForward").off('click').on("click",function(){// 接口参数,删除的table item
            var itemID = $(this).attr("data-item");
            var ForwardUserID =$("#dacAppForward").val();
            var content = $("#appDacText").val();
            if(content==''){
                layer.msg("意见不能为空!");
                return false
            }
            $.fetch({
                url:furl,
                type: 'post',
                data:{
                    ItemID:itemID,
                    ForwardUserID:ForwardUserID,
                    Content:content,
                },
                cb:function(rs){
                    layer.msg("转交完成");
                    tableSub={};                    
                    layer.closeAll();
                    table.reload(TableID,{where:{},
                         done:function(data){
                            autoFixed($(this.elem[0]).next());
                             
                            for(var i =0; i<data.data.length; i++){
                                if(data.data[i].can_approval==true){
                                    $("#danceAppr .layui-table-main tr").eq(i).addClass("ColorPrompt");
                                }else{
                                    $("#danceAppr .layui-table-main tr").eq(i).removeClass("ColorPrompt");
                                }
                                
                            }
                            form.render();
                        }})
                    elem.remove();
                }
            })
        })
    }
    $("#offSelMember").on("click",function(){
        $("#approvPop").hide();
        $("#approvPop").find('textarea').val("");
    })
    $("#approvPop .appNone").on("click",function(){
        $("#approvPop").hide();
        $("#approvPop").find('textarea').val("");
    })

})
})
</script>
<style>
    .layui-table-view .layui-table{
		height: 100%;
	}
</style>
<dtml>
