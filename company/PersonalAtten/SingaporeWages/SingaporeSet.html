<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>新加坡工资设置编辑</title>
<link rel="stylesheet" type="text/css" href="../../../css/iconFont/iconfont.css">
<link rel="stylesheet" type="text/css" href="../../../layui/css/layui.css">
<link rel="stylesheet" type="text/css" href="../../../css/dtree.css">
<link rel="stylesheet" type="text/css" href="../../../css/formSelects-v4.css">
<link rel="stylesheet" type="text/css" href="../../../layui/css/admin.css">
<script src="../../../js/jquery.min.js"></script>
<script src="../../../js/jquery.table2excel.min.js"></script>
<script src="../../../js/common.js"  type="text/javascript"></script>

</head>
<body class="statiBox">
	<div class="layui-fluid">
		<div class="layui-card">
			<div class="layui-tab layui-card-body  layui-tab-brief" lay-filter="salTab">

				<ul class="layui-tab-title">				
					<li  class="layui-this" lay-id="1">工资设置编辑</li>
				</ul>
				<div class="layui-tab-content">
					<div class="layui-tab-item  layui-show">
						<div class=" layui-form">
							<!-- <div style="color: #FF5722">注：点击列表可进行编辑</div> -->
							<div class="layui-item l-mnl">
								<div class="layui-inline">
									<label class="layui-form-label">用户名：</label>
									<div class="layui-input-inline">
										<input type="text"  class="layui-input" id="UserName" name="UserName">
									</div>
								</div>
								<div class="layui-inline">
									<label class="layui-form-label">部门：</label>
									<div class="layui-input-inline">
										<!-- <select id="DepartmentID" lay-filter="DepartmentID" name="DepartmentID"></select> -->
										<select type="text" xm-select="DepartmentID"  id="DepartmentID" name="DepartmentID" placeholder="全部" autocomplete="off" class="xm-input xm-select" xm-select-search="" xm-select-radio=""><option value="">全部</option></select>
									</div>
								</div>
								<div class="layui-inline">
									<label class="layui-form-label">岗位：</label>
									<div class="layui-input-inline">
										<!-- <select id="JobTitleID" lay-filter="JobTitleID"  name="JobTitleID"></select> -->
										<select type="text"  id="JobTitleID" name="JobTitleID" placeholder="全部" autocomplete="off" class="layui-input"  xm-select="JobTitleID"  xm-select-search="" xm-select-radio=""><option value="">全部</option></select>
									</div>
								</div>
								<!-- <div class="layui-inline">
										<label class="layui-form-label">自动更新：</label>
										<div class="layui-input-inline" style="width: 181px;">
											<select type="text"  id="AutoUpdate" name="AutoUpdate" placeholder="" autocomplete="off" class="layui-input"  ><option value="">全部</option><option value="1">是</option><option value="0">否</option></select>
										</div>
									</div> -->
								<!-- <div class="layui-inline" style="margin-top: 5px">
									<label class="layui-form-label">是否发放：</label>
									<div class="layui-input-inline">
										<select id="IsShow" lay-filter="IsShow"  name="IsShow">
											<option value="-1">全部</option>
											<option value="1">是</option>
											<option value="0">否</option>
										</select>
									</div>
								</div> -->
								<div class="layui-inline">
									<button class="layui-btn layui-btn-sm"  lay-filter="filterTabelSel" id="filterTabelSel" title="查询">
										<i class="iconfont icon-sousuo"></i>
									</button>
									<button class="layui-btn layui-btn-sm"  lay-filter="closeLayer" id="closeLayer">
										返回
									</button>
								</div>
							</div>
							<table class="layui-table" lay-filter="SingaporeSetList" id="SingaporeSetList"></table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 用于复杂表头导出的 隐藏table -->
	<table id="report-table" cellpadding=1 cellspacing=1 border =1 style="display: none"></table>
</body>
<style>
	.user-list{
		max-width: 75%;
	}
	.user-list li{
		float: left;
		min-width: 0;
		line-height: 20px;
		max-width: 160px;
		text-overflow: ellipsis;
		padding-right: 40px;
		overflow: hidden;
		margin-right: 4px;
		vertical-align: top;
   		position: relative;
		padding-left: 10px;
	}
	.user-list li.bg{
		background:#f6f6f6;

	}
	.user-list li .layui-tab-close{
		position: absolute;
		right: 8px;
		top: 50%;
		margin: -7px 0 0;
		width: 16px;
		height: 16px;
		line-height: 16px;
		border-radius: 50%;
		font-size: 12px;
		cursor: pointer;
	}   
	.user-list li .layui-tab-close:hover{
		border-radius: 2px;
		background-color: #FF5722;
		color: #fff;
	}
	.xm-select-parent .xm-form-select dl{
        min-width: 220%;
    }
	.layui-table[lay-size=sm] th[data-field="Payback"] {
		background: #1e9fff;
	}
	.layui-table[lay-size=sm] th[data-field="Deduction Mandatory"] {
		background: #FF0000;
		color: #fff;
	}
	.layui-table[lay-size=sm] th[data-field="add_nsd_ordinary"],
	.layui-table[lay-size=sm] th[data-field="NSD.NSD"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_rest_day"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_special_day"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_special_day_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_regular_holiday"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_regular_holiday_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_double_holiday"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_double_holiday_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_ordinary"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_rest_day"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_special_day"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_special_day_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_regular_holiday"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_regular_holiday_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_double_holiday"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_double_holiday_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="de_undertime"]{
		background: #FFFF00;
	}
	.layui-table[lay-size=sm] th[data-field="nsd ot"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_ot_ordinary"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_ot_rest_day"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_ot_special_day"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_ot_special_day_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_ot_regular_holiday"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_ot_regular_holiday_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_ot_double_holiday"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_ot_double_holiday_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_ot_ordinary"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_ot_rest_day"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_ot_special_day"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_ot_special_day_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_ot_regular_holiday"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_nsd_regular_holiday_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_ot_double_holiday"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_ot_double_holiday_falling_on_rest_day"]{
		background: #D9D9D9;
	}
	.layui-table[lay-size=sm] th[data-field="Ordinary"],
	.layui-table[lay-size=sm] th[data-field="add_ot_ordinary"],
	.layui-table[lay-size=sm] th[data-field="add_ot_rest_day"],
	.layui-table[lay-size=sm] th[data-field="add_ot_special_day"],
	.layui-table[lay-size=sm] th[data-field="add_ot_special_day_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="add_ot_regular_holiday"],
	.layui-table[lay-size=sm] th[data-field="add_nsd_regular_holiday_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="add_ot_double_holiday"],
	.layui-table[lay-size=sm] th[data-field="add_ot_double_holiday_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="pb_ot_ordinary"],
	.layui-table[lay-size=sm] th[data-field="pb_ot_rest_day"],
	.layui-table[lay-size=sm] th[data-field="pb_ot_special_day"],
	.layui-table[lay-size=sm] th[data-field="pb_ot_special_day_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="pb_ot_regular_holiday"],
	.layui-table[lay-size=sm] th[data-field="pb_nsd_regular_holiday_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field="pb_ot_double_holiday"],
	.layui-table[lay-size=sm] th[data-field="pb_ot_double_holiday_falling_on_rest_day"],
	.layui-table[lay-size=sm] th[data-field=""]{
		background: #D9E1F2;
	}
</style>
<script src="../../../layui/layui.js"></script>
<script>
	
    layui.config({
		base: '../../../layui/' //静态资源所在路径
	}).extend({
		index: 'index' //主入口模块
	}).use(['index','form','laydate','table','dtree','formSelects'], function(){
        var $ = layui.$
        ,admin = layui.admin
        ,element = layui.element
        ,dtree = layui.dtree
    	,formSelects = layui.formSelects
        ,table = layui.table
        ,router = layui.router();
        element.render();
        element.on('tab(attendanceTabBrief)', function(obj){
			$(window).resize();
		});

		var laydate = layui.laydate,form = layui.form,layer = layui.layer,laypage = layui.laypage,table=layui.table, form = layui.form;
        var isgroup =$("#statiDepSel").attr("data-isgroup")==1?true:false;	
		var iscompanies;
	    // 起始，截止时间选择
        // var StartTime=  d.getFullYear() + '-' + lay.digit(d.getMonth()+1) + '-01';
		// var EndTime = d.getFullYear() + '-' + lay.digit(d.getMonth() + 1) + '-' + lay.digit(d.getDate());
		// var usercheckTime=StartTime;
		function NumberCheckten2(obj,n){
				obj.value = obj.value.replace(/[^\d.]/g,""); //清除"数字"和"."以外的字符
				obj.value = obj.value.replace(/^\./g,""); //验证第一个字符是数字
				obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个, 清除多余的
				obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
				obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d\d\d).*$/,'$1$2.$3'); //只能输入两个小数
			}
		function NumberCheckten2x(obj,n){
				obj.value = obj.value.replace(/[^\d.]/g,""); //清除"数字"和"."以外的字符
				obj.value = obj.value.replace(/^\./g,""); //验证第一个字符是数字
				obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个, 清除多余的
				obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
				obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3'); //只能输入两个小数
		}		
        form.verify({
            startItem:function(value){
                if(!value.match(/\d{4}(\-|\/|.)\d{1,2}\1\d{1,2}/)){
                    return '请选择正确日期';
                };
            },
		})
		//年月选择器
		laydate.render({ 
			elem: '#MonthPH'
			,type: 'month'
			,value:new Date()
		});
		//渲染下拉框 mnl
		//部门下拉
		$.fetch({//部门树列表
			url: "/gateway/department/tree",
			type: 'post',
			cb:function(rs){
				// console.log(rs)
				var formSelectsArr=rs[0].children[0].children;
                // formSelectsArr.unshift({'name':'全部','id':'-1'})
				formSelects.config('DepartmentID', {
					keyName: 'name',
					keyVal: 'id'
				})
				layui.formSelects.data('DepartmentID', 'local', {
					radio: true,
					arr:formSelectsArr
				});
				// formSelects.render('deptId', {
				//     radio: true,                    //是否设置为单选模式
				// });
			}
		});
		$.fetch({//岗位树列表
			url: "/gateway/jobTitle/tree",
			type: 'post',
			cb:function(rs){
				// console.log(rs)
				var formSelectsArr=rs;
				// formSelectsArr.unshift({'name':'全部','id':'-1'})
				formSelects.config('JobTitleID', { 
					keyName: 'title_name',
					keyVal: 'id'
				})
				formSelects.data('JobTitleID', 'local', {
					radio: true,
					arr:formSelectsArr
				}); 
				// formSelects.render('deptId', {
				//     radio: true,                    //是否设置为单选模式
				// });
			}
		});
		
		
		
		
		var now= new Date();
        var year = now.getFullYear(),
            month = now.getMonth() + 1,
            date = now.getDate(),
            wHtml = "",
            zmonth ='',zdate='';
            if(month<10){
                zmonth = "0"+month;
            }else{
                zmonth = month;
            }
            if(date<10){
                zdate = "0"+date;
            }else{
                zdate = date;
			}
			//工资列表获取
			var  userbasicsalaryFun =function(datas){
                var userbasicsalaryName={
                    air_tickets_deduct: 'AirTicketsDeduct'
                    ,basic_salary: 'BasicSalary'
                    ,deduction: 'Deduction'
                    ,rental_fees_jian:'RentalFeesJian'
                    ,guarantee_deduct: 'GuaranteeDeduct'
                    ,medicine_subsidy: 'MedicineSubsidy'
                    ,spring_festival_subsidy: 'SpringFestivalSubsidy'
                    ,temp_visa_deduct: 'TempVisaDeduct'
                    ,travel_visa_deduct: 'TravelVisaDeduct'
                    ,visa_deduct: 'VisaDeduct'
                    ,water_electricity_jian: 'WaterElectricityJian'
                    ,wrong_money_jian: 'WrongMoneyJian'
                    
                    ,first_currency_amount: 'FirstCurrencyUnitID'
                    ,first_currency_unit_id: 'FirstCurrencyAmount'
                    ,ticheng_jia:'TiCheng'
                    ,xiangmu_jixiao_jia:'XiangMuJiXiao'
                }
                var userbasicsalaryUni={}
                // datas['IsFilipino']=0;
                $.fetch({
                    url:'/gateway/usersalary/sg/userbasicsalary',
                    type: 'post',
                    data:datas,
                    cb:function(rs){
                        var cols= [{type:'checkbox',},{type:'numbers',title:'序号'},{field:'user_name',title:'姓名',sort:true,align: 'center',minWidth:80},{field:'dpt_name',title:'部门',align: 'center',sort:true,minWidth:110},{field:'title_name',title:'岗位',sort:true,align: 'center',minWidth:110},{field:'basic_salary',title:'基本薪资',align: 'center',sort:true,minWidth:110},{field:'is_show',title:'显示在工资列表',align: 'center',sort:true,minWidth:130,templet: function (d){ 
                            return d.is_show==1?'是':'否'
                        }}
                        // {field:'basic_currency_name',title:'基本薪资币种',align: 'center',sort:true,minWidth:110}
                    ];
                        cols.push({field:'creator',title:'创建人',align: 'center',fixed:'right',sort:true,minWidth:100,templet: function (d){ 
                            return d.creator==''||d.creator==null?'':d.creator
                        }},
                        // {field:'apply_result_desc',title:'状态',align: 'center',fixed:'right',sort:true,minWidth:90},
                        {field:'',title:'操作',minWidth:90,fixed:'right',
                            toolbar:'<div><a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a></div>'
                            
                        })
                        var data=rs.salary_list;
                        var allStaList = table.render({
                            elem: '#SingaporeSetList',
                            limit:100000000,
                            toolbar:'<div><a class="layui-btn layui-btn-xs" lay-event="editAll">批量编辑</a><a class="layui-btn layui-btn-xs" lay-event="showAll">设置是否显示在工资列表</a></div>',
                            defaultToolbar:'',
                            page:false,
                            text: {
                                none: '暂无' 
                            },
                            size:'sm',
                            even:true,
                            initSort: {
                                field: 'basic_salary' //排序字段，对应 cols 设定的各字段名
                                ,type: 'desc' //排序方式  asc: 升序、desc: 降序、null: 默认排序
                            },
                            height: 'full-235',
                            cols: [cols],
                            data:data,
                            done:function(){
                                $("div[lay-id='SingaporeSetList'] div.layui-table-header th div").height(38)
                                $(window).resize();
                            }
                        })
                        
            
                        table.on('tool(SingaporeSetList)', function(obj){
                            var layEvent = obj.event;
                            if(layEvent === 'edit'){
                                $.fetch({
                                    url:"/gateway/usersalary/mnl/rateinit",
                                    type:'post',
                                    cb:function(rate){
                                        var ophtml="";
                                        var rateD={};
                                        for(var i=0;i<rate.length;i++){
                                            ophtml+='<option value="'+rate[i].id+'">'+rate[i].zh_name+'('+rate[i].short_code+')</option>'
                                            rateD[rate[i].id]=rate[i].zh_name+'('+rate[i].short_code+')'
                                        }
                                        
                                        var conthtmls6input='';
                                        var userbasicsalaryUid=obj.data.uid;
                                        for(key in obj.data){
                                            var labelText=$('th[data-field="'+key+'"]').text();
                                            if(labelText!=''&&userbasicsalaryName[key]!=undefined&&key!='basic_salary'){
                                                conthtmls6input += '<div class="layui-inline">'
                                                                +'<label class="layui-form-label" style="width: 128px;">'+labelText+'</label>'
                                                                    +'<div class="layui-input-inline">'
                                                                        +'<input type="text" name="'+userbasicsalaryName[key]+'" value="'+(obj.data[key]==null?'':obj.data[key])+'" placeholder="请输入" autocomplete="off" class="layui-input num2">'
                                                                    +'</div>'
                                                                    +'<div class="layui-form-mid layui-word-aux" style=" width: 110px;">'+rateD[userbasicsalaryUni[key]]+'</div>'
                                                                +'</div>'
                                            }
                                        }
                                        if(obj.data.is_all==null||obj.data.is_all==''){
                                            obj.data.is_all=0;
                                        }
                                        var inputHtml =''
                                        if(obj.data.is_show==0){
                                            inputHtml+='<input type="radio" name="sex" value="1" title="是"><input type="radio" name="sex" value="0" title="否" checked>'
                                        }else if(obj.data.is_show==1){
                                            inputHtml+='<input type="radio" name="sex" value="1" title="是" checked><input type="radio" name="sex" value="0" title="否">'
                                        }else{
                                            inputHtml+='<input type="radio" name="sex" value="1" title="是" checked><input type="radio" name="sex" value="0" title="否">'
                                        }
                                        var conthtmls6 ='<div class="layui-card">'
                                                        +'<div class="layui-card-body layui-form">'
                                                            +'<div class="layui-form-item">'
                                                                    +'<div class="layui-inline"><label class="layui-form-label" style="width: 128px;">姓名：</label><div class="layui-form-mid layui-word-aux">'+(obj.data.user_name==null?"暂无":obj.data.user_name)+'</div></div>'
                                                                    +'<div class="layui-inline"><label class="layui-form-label" style="width: 128px;">部门：</label><div class="layui-form-mid layui-word-aux">'+(obj.data.dpt_name==null?"暂无":obj.data.dpt_name)+'</div></div>'
                                                            +'</div>'
                                                            +'<div class="layui-form-item">'
                                                                +'<div class="layui-form-item">'
                                                                    +'<label class="layui-form-label" style="width: 128px;">是否有CPF(员)</label>'
                                                                    +'<div class="layui-input-inline">'
                                                                        +'<input type="radio" name="CPF" value="0" title="否" checked>'
                                                                        +'<input type="radio" name="CPF" value="1" title="是">'
                                                                    +'</div>'
                                                                +'</div>'
                                                                +'<div class="layui-form-item">'
                                                                    +'<label class="layui-form-label" style="width: 128px;">是否有CDAC(员)</label>'
                                                                    +'<div class="layui-input-inline">'
                                                                        +'<input type="radio" name="CDAC" value="0" title="否" checked>'
                                                                        +'<input type="radio" name="CDAC" value="1" title="是">'
                                                                    +'</div>'
                                                                +'</div>'
                                                                +'<div class="layui-form-item">'
                                                                    +'<label class="layui-form-label" style="width: 128px;">是否有SDL(公)</label>'
                                                                    +'<div class="layui-input-inline">'
                                                                        +'<input type="radio" name="SDL" value="0" title="否" checked>'
                                                                        +'<input type="radio" name="SDL" value="1" title="是">'
                                                                    +'</div>'
                                                                +'</div>'
                                                                +'<div class="layui-inline">'
                                                                        +'<label class="layui-form-label" style="width: 128px;"><span style="color:red">*</span>基本薪资</label>'
                                                                        +'<div class="layui-input-inline"><input type="text" name="BasicSalary"  id="BasicSalary" value="'+(obj.data.basic_salary==null?'':obj.data.basic_salary)+'"  placeholder="请输入" autocomplete="off" class="layui-input num2"></div>'
                                                                        +'<div class="layui-form-mid layui-word-aux" style=" width: 110px;"></div>'
                                                                +'</div>'
                                                                // +conthtmls6input
                                                            +'</div>'
                                                            +'<div class="layui-form-item">'
                                                                +'<div class="layui-input-block">'
                                                                    +' <button class=" layui-btn" id="subuserbasicsalary">保存</button>'
                                                                    +' <button class=" layui-btn" id="backuserbasicsalary">取消</button>'
                                                                +'</div>'
                                                            +'</div>'

                                                        +'</div>'
                                                    +'</div>'
                                            layer.open({
                                                title:'基本工资设置',
                                                type: 1, 
                                                id:"conthtmls6",
                                                content:conthtmls6,
                                                resize:false,            
                                                area:['50%', '50%'],   
                                                success:function(layero,index){
                                                
                                                    if(obj.data.has_sdl_gong==1){
                                                        $("input[name='SDL'][value='1']").attr('checked',true);
                                                        $("input[name='SDL'][value='0']").removeAttr('checked')
                                                    }else{
                                                        $("input[name='SDL'][value='0']").attr('checked',true);
                                                        $("input[name='SDL'][value='1']").removeAttr('checked')
                                                    }
                                                    if(obj.data.has_cdac_yuan==1){
                                                        $("input[name='CDAC'][value='1']").attr('checked',true);
                                                        $("input[name='CDAC'][value='0']").removeAttr('checked')
                                                    }else{
                                                        $("input[name='CDAC'][value='0']").attr('checked',true);
                                                        $("input[name='CDAC'][value='1']").removeAttr('checked')
                                                    }
                                                    if(obj.data.has_cpf_yuan==1){
                                                        $("input[name='CPF'][value='1']").attr('checked',true);
                                                        $("input[name='CPF'][value='0']").removeAttr('checked')
                                                    }else{
                                                        $("input[name='CPF'][value='0']").attr('checked',true);
                                                        $("input[name='CPF'][value='1']").removeAttr('checked')
                                                    }
                                                    form.render();
                                                    // 取消   
                                                    $("#backuserbasicsalary").on("click",function(){
                                                        layer.close(index);
                                                    })

                                                    // 提交
                                                    $("#subuserbasicsalary").on("click",function(){
                                                        var subData={};
                                                        var BasicSalaryVal=$("#BasicSalary").val();
                                                        var HasSdlYuan = $("input[name='SDL']:checked").val();
                                                        var HasCdacYuan = $("input[name='CDAC']:checked").val();
                                                        var HasCpfYuan = $("input[name='CPF']:checked").val();
                                                        if(BasicSalaryVal==''||BasicSalaryVal==null){
                                                            layer.msg('基本薪资不能为空');
                                                            return false															
                                                        }
                                                        $("#conthtmls6").find('input.layui-input.num2').each(function(){
                                                            var subName=$(this).attr("name");
                                                            subData[subName]=$(this).val();
                                                        })
                                                        subData['UserID']=userbasicsalaryUid;
                                                        subData['HasCpfYuan']=HasCpfYuan;
                                                        subData['HasCdacYuan']=HasCdacYuan;
                                                        subData['HasSdlGong']=HasSdlYuan;
                                                        					
                                                        $.fetch({
                                                            url:'/gateway/usersalary/sg/setbasicsalary',
                                                            type: 'post',
                                                            data:subData,
                                                            cb:function(rs){
                                                                layer.msg('保存成功');
                                                                layer.close(index);

                                                                var DepartmentID=formSelects.value('DepartmentID', 'valStr');
                                                                var JobTitleID=formSelects.value('JobTitleID', 'valStr');
                                                                userbasicsalaryFun({
                                                                    UserName:$("#UserName").val(),
                                                                    DepartmentID:DepartmentID==''?'-1':DepartmentID,
                                                                    JobTitleID:JobTitleID==''?'-1':JobTitleID,
                                                                })
                                                            }
                                                        })
                                                    })
                                                }
                                            })
                                            //obj.del(); //删除当前行
                                            //obj.update(fields) //修改当前行数据
                                        }
                                    })
                                            
                                    
                                }
                        });
                        
                        table.on('toolbar(SingaporeSetList)', function(obj){
                                //得到当前行数据
                            var checkStatus = table.checkStatus(obj.config.id);
                            if(checkStatus.data.length===0){
                                layer.msg('无选中项，无法设置。');
                                return false
                            }
                            var uNames='';
                            var uIdsArr=[];
                            for(var i =0;i<checkStatus.data.length;i++){
                                uNames+='<li class="bg"><span>'+checkStatus.data[i].user_name+';</span><i data-id="'+checkStatus.data[i].uid+'" class="layui-icon layui-unselect layui-tab-close">ဆ</i></li>';
                                uIdsArr.push(checkStatus.data[i].uid);
                            }
                            
                            var SubUidsStr=uIdsArr.join(',');
                            var userAmount=checkStatus.data.length;
                            var firstData=checkStatus.data[0];
                            var layEvent = obj.event;
                            if(layEvent === 'editAll'){
                                $.fetch({
                                    url:"/gateway/usersalary/mnl/rateinit",
                                    type:'post',
                                    cb:function(rate){
                                        var ophtml="";
                                        var rateD={};
                                        for(var i=0;i<rate.length;i++){
                                            ophtml+='<option value="'+rate[i].id+'">'+rate[i].zh_name+'('+rate[i].short_code+')</option>'
                                            rateD[rate[i].id]=rate[i].zh_name+'('+rate[i].short_code+')'
                                        }
                                        
                                        var conthtmls6input='';
                                        for(key in firstData){
                                            var labelText=$('th[data-field="'+key+'"]').text();
                                            if(labelText!=''&&userbasicsalaryName[key]!=undefined&&key!='basic_salary'){
                                                conthtmls6input += '<div class="layui-inline">'
                                                                    +'<label class="layui-form-label" style="width: 128px;">'+labelText+'</label>'
                                                                    +'<div class="layui-input-inline">'
                                                                        +'<input type="text" name="'+userbasicsalaryName[key]+'" value="'+(firstData[key]==null?'':firstData[key])+'" placeholder="请输入" autocomplete="off" class="layui-input num2">'
                                                                    +'</div>'
                                                                    +'<div class="layui-form-mid layui-word-aux" style=" width: 110px;">'+rateD[userbasicsalaryUni[key]]+'</div>'
                                                                +'</div>'
                                                                
                                            }
                                        }
                                    
                                        if(firstData.is_all==null||firstData.is_all==''){
                                            firstData.is_all=0;
                                        }

                                        var inputHtml =''
                                        if(firstData.is_show==0){
                                            inputHtml+='<input type="radio" name="sex" value="1" title="是"><input type="radio" name="sex" value="0" title="否" checked>'
                                        }else if(firstData.is_show==1){
                                            inputHtml+='<input type="radio" name="sex" value="1" title="是" checked><input type="radio" name="sex" value="0" title="否">'
                                        }else{
                                            inputHtml+='<input type="radio" name="sex" value="1" title="是" checked><input type="radio" name="sex" value="0" title="否">'
                                        }
                                        
                                        var conthtmls6 ='<div class="layui-card">'
                                                            +'<div class="layui-card-body layui-form">'
                                                                    +'<div class="layui-form-item">'
                                                                            +'<div class="layui-inline"><label class="layui-form-label" style="width: 128px;">用户名：</label><ul class="layui-form-mid layui-word-aux user-list">'+(uNames==null?"暂无":uNames)+'</ul><div class="layui-form-mid layui-word-aux" style="display:none;"><button class="layui-btn layui-btn-xs" id="cancelDel">撤销删除</button></div></div>'
                                                                            +'<div class="layui-inline"><label class="layui-form-label" style="width: 128px;">已选中：</label><div class="layui-form-mid layui-word-aux user-amount">'+(userAmount==null?"暂无":userAmount)+'人</div></div>'
                                                                    +'</div>'
                                                                    +'<div class="layui-form-item">'
                                                                        +'<div class="layui-form-item">'
                                                                            +'<label class="layui-form-label" style="width: 128px;">是否有CPF(员)</label>'
                                                                            +'<div class="layui-input-inline">'
                                                                                +'<input type="radio" name="CPF" value="0" title="否" checked>'
                                                                                +'<input type="radio" name="CPF" value="1" title="是">'
                                                                            +'</div>'
                                                                        +'</div>'
                                                                        +'<div class="layui-form-item">'
                                                                            +'<label class="layui-form-label" style="width: 128px;">是否有CDAC(员)</label>'
                                                                            +'<div class="layui-input-inline">'
                                                                                +'<input type="radio" name="CDAC" value="0" title="否" checked>'
                                                                                +'<input type="radio" name="CDAC" value="1" title="是">'
                                                                            +'</div>'
                                                                        +'</div>'
                                                                        +'<div class="layui-form-item">'
                                                                            +'<label class="layui-form-label" style="width: 128px;">是否有SDL(公)</label>'
                                                                            +'<div class="layui-input-inline">'
                                                                                +'<input type="radio" name="SDL" value="0" title="否" checked>'
                                                                                +'<input type="radio" name="SDL" value="1" title="是">'
                                                                            +'</div>'
                                                                        +'</div>'
                                                                        +'<div class="layui-inline">'
                                                                                +'<label class="layui-form-label" style="width: 128px;"><span style="color:red">*</span>基本薪资</label>'
                                                                                +'<div class="layui-input-inline"><input type="text" name="BasicSalary"  id="BasicSalary" value="'+(firstData.basic_salary==null?'':firstData.basic_salary)+'"  placeholder="请输入" autocomplete="off" class="layui-input num2"></div>'
                                                                                +'<div class="layui-form-mid layui-word-aux" style=" width: 110px;"></div>'
                                                                        +'</div>'
                                                                    +'</div>'
                                                                    +'<div class="layui-form-item">'
                                                                        +'<div class="layui-input-block">'
                                                                            +' <button class=" layui-btn" id="subuserbasicsalary">保存</button>'
                                                                            +' <button class=" layui-btn" id="backuserbasicsalary">取消</button>'
                                                                        +'</div>'
                                                                    +'</div>'

                                                                +'</div>'
                                                        +'</div>'
                                            layer.open({
                                                title:'基本工资设置',
                                                type: 1, 
                                                id:"conthtmls6",
                                                content:conthtmls6,
                                                resize:false,            
                                                area:['50%', '50%'],      
                                                success:function(layero,index){
                                                    
                                                    if(userAmount==1){
                                                        $(".user-list li>.layui-tab-close").hide();
                                                    }else{
                                                        $(".user-list li>.layui-tab-close").show();
                                                    }
                                                    $(".user-list").on("click",'li>.layui-tab-close',function(){
                                                        var uid=$(this).attr('data-id');
                                                        $(this).parent("li").remove();
                                                        var SubUidsArr=SubUidsStr.split(',');
                                                        SubUidsArr.splice($.inArray(uid,SubUidsArr),1);
                                                        SubUidsStr=SubUidsArr.join(',');
                                                        userAmount=userAmount-1;
                                                        $(".user-amount").html(userAmount)
                                                        $("#cancelDel").parent('div').show();
                                                        if(userAmount==1){
                                                            $(".user-list li>.layui-tab-close").hide();
                                                        }else{
                                                            $(".user-list li>.layui-tab-close").show();
                                                            
                                                        }
                                                    })
                                                        
                                                    $("#cancelDel").on("click",function(){
                                                        $(".user-list").html(uNames);
                                                        SubUidsStr=uIdsArr.join(',');
                                                        userAmount=uIdsArr.length;
                                                        $(".user-amount").html(userAmount)
                                                        $("#cancelDel").parent('div').hide();
                                                        
                                                        if(userAmount==1){
                                                            $(".user-list li>.layui-tab-close").hide();
                                                        }else{
                                                            $(".user-list li>.layui-tab-close").show();
                                                            
                                                        }
                                                    })

                                                    $("#backuserbasicsalary").on("click",function(){
                                                        layer.close(index);
                                                    })
                                                    form.on('radio(checkIsAll)', function(data){
                                                        if(data.value==1){
                                                            $(".part").addClass('layui-hide').removeClass('layui-show');
                                                        }else{
                                                            
                                                            $(".part").addClass('layui-show').removeClass('layui-hide');
                                                        }
                                                        
                                                    }); 
                                                    $("#conthtmls6").on('keyup','.layui-input.num2',function () {
                                                        NumberCheckten2x(this)
                                                    }).bind("paste", function () {  //CTR+V事件处理
                                                        NumberCheckten2x(this)
                                                    }).css("ime-mode", "disabled"); //CSS设置输入法不可用
                                                            
                                                    $("#FirstCurrencyUnitID").val(firstData.first_currency_unit_id);
                                                    $("#SecondCurrencyUnitID").val(firstData.second_currency_unit_id);
                                                    
                                                    if(firstData.has_sdl_gong==1){
                                                        $("input[name='SDL'][value='1']").attr('checked',true);
                                                        $("input[name='SDL'][value='0']").removeAttr('checked')
                                                    }else{
                                                        $("input[name='SDL'][value='0']").attr('checked',true);
                                                        $("input[name='SDL'][value='1']").removeAttr('checked')
                                                    }
                                                    if(firstData.has_cdac_yuan==1){
                                                        $("input[name='CDAC'][value='1']").attr('checked',true);
                                                        $("input[name='CDAC'][value='0']").removeAttr('checked')
                                                    }else{
                                                        $("input[name='CDAC'][value='0']").attr('checked',true);
                                                        $("input[name='CDAC'][value='1']").removeAttr('checked')
                                                    }
                                                    if(firstData.has_cpf_yuan==1){
                                                        $("input[name='CPF'][value='1']").attr('checked',true);
                                                        $("input[name='CPF'][value='0']").removeAttr('checked')
                                                    }else{
                                                        $("input[name='CPF'][value='0']").attr('checked',true);
                                                        $("input[name='CPF'][value='1']").removeAttr('checked')
                                                    }
                                                    form.render();
                                                    $("#subuserbasicsalary").on("click",function(){
                                                        var subData={};
                                                        var BasicSalaryVal=$("#BasicSalary").val();
                                                        var HasSdlYuan = $("input[name='SDL']:checked").val();
                                                        var HasCdacYuan = $("input[name='CDAC']:checked").val();
                                                        var HasCpfYuan = $("input[name='CPF']:checked").val();
                                                        if(BasicSalaryVal==''||BasicSalaryVal==null){
                                                            layer.msg('基本薪资不能为空');
                                                            return false
                                                        }
                                                        $("#conthtmls6").find('input.layui-input.num2').each(function(){
                                                            var subName=$(this).attr("name");
                                                            subData[subName]=$(this).val();
                                                        })
                                                        subData['UserID']=SubUidsStr;
                                                        subData['HasCpfYuan']=HasCpfYuan;
                                                        subData['HasCdacYuan']=HasCdacYuan;
                                                        subData['HasSdlGong']=HasSdlYuan;					
                                                        $.fetch({
                                                            url:'/gateway/usersalary/sg/setbasicsalary',
                                                            type: 'post',
                                                            data:subData,
                                                            cb:function(rs){
                                                                layer.msg('保存成功');
                                                                layer.close(index);
                                                                var DepartmentID=formSelects.value('DepartmentID', 'valStr');
                                                                var JobTitleID=formSelects.value('JobTitleID', 'valStr');
                                                                userbasicsalaryFun({
                                                                    UserName:$("#UserName").val(),
                                                                    DepartmentID:DepartmentID==''?'-1':DepartmentID,
                                                                    JobTitleID:JobTitleID==''?'-1':JobTitleID,
                                                                })
                                                            }
                                                        })
                                                    })
                                                }
                                            })
                                        }
                                    })
                                }else if(layEvent === 'showAll'){
													// console.log(uIdsArr)
													// var showUIds=uIdsArr.join(',')
													var conthtmls7 ='<div class="layui-card">'
																		+'<div class="layui-card-body layui-form">'
																				+'<div class="layui-form-item">'
																							+'<div class="layui-inline"><label class="layui-form-label" style="width: 128px;">用户名：</label><ul class="layui-form-mid layui-word-aux user-list">'+(uNames==null?"暂无":uNames)+'</ul><div class="layui-form-mid layui-word-aux" style="display:none"><button class="layui-btn layui-btn-xs" id="cancelDel">撤销删除</button></div></div>'
																							+'<div class="layui-inline"><label class="layui-form-label" style="width: 128px;">已选中：</label><div class="layui-form-mid layui-word-aux user-amount">'+(userAmount==null?"暂无":userAmount)+'人</div></div>'
																					+'</div>'
																					+'<div class="layui-form-item">'
																						+'<div class="layui-inline">'
																								+'<label class="layui-form-label" style="width: 128px;">显示在工资列表</label>'
																								+'<div class="layui-input-inline">'
																									+'<input type="radio" lay-filter="IsShow" name="IsShow" value="1" title="是">'
																									+'<input type="radio" lay-filter="IsShow" name="IsShow" value="0" title="否" >'
																								+'</div>'
																						+'</div>'
																					+'</div>'
																					+'<div class="layui-form-item">'
																						+'<div class="layui-input-block">'
																							+' <button class=" layui-btn" id="subuserbasicsalary">确定</button>'
																							+' <button class=" layui-btn" id="backuserbasicsalary">取消</button>'
																						+'</div>'
																					+'</div>'
																		+'</div>'
																	+'</div>'
														layer.open({
																title:'设置显示',
																type: 1, 
																id:"conthtmls7",
																content:conthtmls7,
																resize:false,            
																area:['80%','80%'],   
																success:function(layero,index){
																	if(userAmount==1){
																		$(".user-list li>.layui-tab-close").hide();
																	}else{
																		$(".user-list li>.layui-tab-close").show();
																		// $("#cancelDel").parent('div').show();
																	}
																	form.render();
																	$(".user-list").on("click",'li>.layui-tab-close',function(){
																		var uid=$(this).attr('data-id');
																		$(this).parent("li").remove();
																		var SubUidsArr=SubUidsStr.split(',');
																		SubUidsArr.splice($.inArray(uid,SubUidsArr),1);
																		SubUidsStr=SubUidsArr.join(',');
																		userAmount=userAmount-1;
																		$(".user-amount").html(userAmount)
																		$("#cancelDel").parent('div').show();
																		if(userAmount==1){
																			$(".user-list li>.layui-tab-close").hide();
																		}else{
																			$(".user-list li>.layui-tab-close").show();
																			
																		}
																	})
																	 
																	$("#cancelDel").on("click",function(){
																		$(".user-list").html(uNames);
																		SubUidsStr=uIdsArr.join(',');
																		userAmount=uIdsArr.length;
																		$(".user-amount").html(userAmount)
																		$("#cancelDel").parent('div').hide();
																		
																		if(userAmount==1){
																			$(".user-list li>.layui-tab-close").hide();
																		}else{
																			$(".user-list li>.layui-tab-close").show();
																			
																		}
																	})
																	
																	$("#subuserbasicsalary").on("click",function(){
																		var IsShow =$("input[name='IsShow']:checked").val();
																		$.fetch({
																			url:'/gateway/usersalary/my/setshow',
																			type: 'post',
																			data:{
																				UserID:SubUidsStr,
																				IsShow:IsShow
																			},
																			cb:function(rs){
																				layer.msg('保存成功');
																				layer.close(index);
																				var DepartmentID=formSelects.value('DepartmentIDAll', 'valStr');
																				var JobTitleID=formSelects.value('JobTitleIDAll', 'valStr');
																				var IsFilipino=$("#IsFilipino").val();
																				// console.log(DepartmentID,JobTitleID,000)
																					// userbasicsalaryFun()
																					var DepartmentID=formSelects.value('DepartmentID', 'valStr');
                                                                                    var JobTitleID=formSelects.value('JobTitleID', 'valStr');		
                                                                                    userbasicsalaryFun({
                                                                                        UserName:$("#UserName").val(),
                                                                                        DepartmentID:DepartmentID==''?'-1':DepartmentID,
                                                                                        JobTitleID:JobTitleID==''?'-1':JobTitleID,
                                                                                    })
																					// allStaListtAll.reload({where:{
																					// 	UserName:$("#UserNameAll").val(),
																					// 	DepartmentID:DepartmentID==''?'-1':DepartmentID,
																					// 	JobTitleID:JobTitleID==''?'-1':JobTitleID,
																					// 	IsFilipino:IsFilipino==''?'-1':IsFilipino,
																					// 	AutoUpdate:-1
																						
																					// 	//IsShow:$("#IsShow").val(),
																					// }})
																				}
																		})
																	})
																	$("#backuserbasicsalary").on("click",function(){
																		layer.close(index);
																	})
																}
														})
												}
                        });
                    }
                })
            }				
			userbasicsalaryFun({
				UserName:'',
				DepartmentID:'-1',
				JobTitleID:'-1',
			});
			
			$("#filterTabelSel").on("click",function(){
				var DepartmentID=formSelects.value('DepartmentID', 'valStr');
				var JobTitleID=formSelects.value('JobTitleID', 'valStr');		
				userbasicsalaryFun({
					UserName:$("#UserName").val(),
					DepartmentID:DepartmentID==''?'-1':DepartmentID,
					JobTitleID:JobTitleID==''?'-1':JobTitleID,
				})
			})
			$("#closeLayer").on("click",function(){
				layui.formSelects.value('DepartmentID', []); 
				layui.formSelects.value('JobTitleID', []); 
				$("#AutoUpdate").val('');
				$("#UserName").val('');
				form.render();
				userbasicsalaryFun({
					UserName:'',
					DepartmentID:'-1',
					JobTitleID:'-1',
				});
			})
			var NumberCheckten =function(num) {
				var str = num;
				var len1 = str.substr(0, 1);
				var len2 = str.substr(1, 1);
				//如果第一位是0，第二位不是点，就用数字把点替换掉
				if (str.length > 1 && len1 == 0 && len2 != ".") {
				str = str.substr(1, 1);
				}
				//第一位不能是.
				if (len1 == ".") {
					str = "";
				}
				//限制只能输入一个小数点
				if (str.indexOf(".") != -1) {
				var str_ = str.substr(str.indexOf(".") + 1);
				if (str_.indexOf(".") != -1) {
					str = str.substr(0, str.indexOf(".") + str_.indexOf(".") + 1);
				}
				}
				//正则替换，保留数字和小数点
				str = str.replace(/[^\d^\.]+/g,'')
				//如果需要保留小数点后两位，则用下面公式
				var result = (str.toString()).indexOf(".");
				if(result != -1) {
					// alert("含有小数点");
					
					var num3=str.split('.')[1].slice(0,10);
				} else {
					// alert("不含小数点");
				}
				
				str = str.replace(/\.\d\d\d\d\d\d\d\d\d\d\d$/,(num3==''||num3==undefined)?'':'.'+num3)
				
				return str;
			}
			
			var NumberCheckten4 =function(num) {
				var str = num;
				var len1 = str.substr(0, 1);
				var len2 = str.substr(1, 1);
				//如果第一位是0，第二位不是点，就用数字把点替换掉
				if (str.length > 1 && len1 == 0 && len2 != ".") {
				str = str.substr(1, 1);
				}
				//第一位不能是.
				if (len1 == ".") {
					str = "";
				}
				//限制只能输入一个小数点
				if (str.indexOf(".") != -1) {
				var str_ = str.substr(str.indexOf(".") + 1);
				if (str_.indexOf(".") != -1) {
					str = str.substr(0, str.indexOf(".") + str_.indexOf(".") + 1);
				}
				}
				//正则替换，保留数字和小数点
				str = str.replace(/[^\d^\.]+/g,'')
				//如果需要保留小数点后两位，则用下面公式
				var result = (str.toString()).indexOf(".");
				if(result != -1) {
					// alert("含有小数点");
					
					var num3=str.split('.')[1].slice(0,4);
				} else {
					// alert("不含小数点");
				}
				
				str = str.replace(/\.\d\d\d\d\d$/,(num3==''||num3==undefined)?'':'.'+num3)
				
				return str;
			}
			$("#setdeductionForm").on('keyup','.amountNumber60',function () {
				if(0<=$(this).val()&&$(this).val()<=60){$(this).val(NumberAmount($(this).val()));}
         		else{
					$(this).val('')
				}
			}).bind("paste", function () {  //CTR+V事件处理
				if(0<=$(this).val()&&$(this).val()<=60){$(this).val(NumberAmount($(this).val()));}
				else{
					$(this).val('')
				}
				
			}).css("ime-mode", "disabled"); //CSS设置输入法不可用
			$("#setdeductionForm").on('keyup','.amountNumber0-31',function () {
				if(0<=$(this).val()&&$(this).val()<=31){$(this).val(NumberAmount($(this).val()));}
         		else{
					$(this).val('')
				}
			}).bind("paste", function () {  //CTR+V事件处理
				if(0<=$(this).val()&&$(this).val()<=31){$(this).val(NumberAmount($(this).val()));}
				else{
					$(this).val('')
				}
				
			}).css("ime-mode", "disabled"); //CSS设置输入法不可用
			$("#setdeductionForm").on('keyup','.amountNumber',function () {
				$(this).val(NumberAmount($(this).val()));
			}).bind("paste", function () {  //CTR+V事件处理
				$(this).val(NumberAmount($(this).val()));
				
			}).css("ime-mode", "disabled"); //CSS设置输入法不可用
			$("#setdeductionForm").on('keyup','.receipt100',function () {
				if(0<=$(this).val()&&$(this).val()<=100){$(this).val(NumberCheckten($(this).val()));}
				else{
					$(this).val('')
				}
			}).bind("paste", function () {  //CTR+V事件处理
				if(0<=$(this).val()&&$(this).val()<=100){$(this).val(NumberCheckten($(this).val()));}
				else{
					$(this).val('')
				}
			}).css("ime-mode", "disabled"); //CSS设置输入法不可用


			element.on('tab(salTab)', function(data){
				table.resize('SingaporeSetList');
			});
})
</script>
</html>
