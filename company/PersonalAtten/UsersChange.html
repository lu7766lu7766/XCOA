<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>人事变动列表</title>
<link rel="stylesheet" type="text/css" href="../../css/iconFont/iconfont.css">
<link rel="stylesheet" type="text/css" href="../../layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="../../css/formSelects-v4.css">
    <link rel="stylesheet" type="text/css" href="../../layui/css/admin.css">
<script src="../../js/jquery.min.js"></script>
</head>
	
<body layadmin-themealias="default">
    <div class="layui-fluid">
        <div class="layui-card">
            <div class="layui-card-header">人事变动列表</div>
                <div class="layui-card-body">
                    <div class=" layui-form" lay-filter="performanceForm">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">
                                    ID
                                </label>
                                <div class="layui-input-inline">
                                    <input type="text"  id="changeId" name="changeId" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">状态</label>
                                <div class="layui-inline">
                                    <select id="status" lay-filter="status" name="status">
                                        <option value="-1">全部</option>
                                        <option value="0">待审批</option>
                                        <option value="1">已否决</option>
                                        <option value="2">已通过</option>     
                                    </select>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">
                                    标题
                                </label>
                                <div class="layui-input-inline">
                                    <input type="text"  id="changeTitle" name="changeTitle" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">
                                    填写人
                                </label>
                                <div class="layui-input-inline">
                                    <input type="text"  id="createrName" name="createrName" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>                       
                            
                        </div>
                        <div class="layui-form-item">   
                            <div class="layui-inline">
                                <label class="layui-form-label">
                                    员工名字
                                </label>
                                <div class="layui-input-inline">
                                    <input type="text"  id="changerName" name="changerName" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div> 
                            <div class="layui-inline">
                                <label class="layui-form-label">变动选项</label>
                                <div class="layui-inline">
                                    <select id="changeType" lay-filter="changeType" name="changeType">
                                        <option value="-1">全部</option>
                                        <option value="1">调动</option>
                                        <option value="2">晋升</option>
                                        <option value="3">降职</option>     
                                    </select>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">
                                    填写日期
                                </label>
                                <div class="layui-input-inline">
                                    <input type="text" class="layui-input" id="createStarttime" name="createStarttime">
                                </div>
                                <div class="layui-input-inline" style="width: 10px">~</div>
                                
                                <div class="layui-input-inline">
                                    <input type="text" class="layui-input" id="createEndtime" name="createEndtime">
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item">  
                             <div class="layui-inline">
                                <label class="layui-form-label">
                                    原部门
                                </label>
                                <div class="layui-input-inline">
                                    <select type="text" xm-select="oldDeptId"  id="oldDeptId" name="oldDeptId" placeholder="" autocomplete="off" class="xm-input xm-select" xm-select-search="" xm-select-radio=""></select>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">
                                    原岗位
                                </label>
                                <div class="layui-input-inline">
                                    <select type="text"  id="oldTitleId" name="oldTitleId" placeholder="" autocomplete="off" class="layui-input"  xm-select="oldTitleId"  xm-select-search="" xm-select-radio=""></select>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">
                                    新部门
                                </label>
                                <div class="layui-input-inline">
                                    <select type="text" xm-select="newDeptId"  id="newDeptId" name="newDeptId" placeholder="" autocomplete="off" class="xm-input xm-select" xm-select-search="" xm-select-radio=""></select>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">
                                    新岗位
                                </label>
                                <div class="layui-input-inline">
                                    <select type="text"  id="newTitleId" name="newTitleId" placeholder="" autocomplete="off" class="layui-input"  xm-select="newTitleId"  xm-select-search="" xm-select-radio=""></select>
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item"> 
                            <div class="layui-inline">
                                 <button id="InquireSur" class="layui-btn" lay-submit lay-filter="InquireSur" title="查询"><i class="iconfont icon-sousuo"></i></button>
                                 <button id="backquireSur" class="layui-btn">重置</button>
                            </div>
                        </div>  
                    </div>
                    <table id="performance" class="" lay-filter="performance"></table>
                </div>
            </div>
        </div>
    </div>
</body>
<style>
    .xm-select-parent .xm-form-select dl{
        min-width: 220%;
    }
</style>
<script src="../../layui/layui.js"></script>
<script src="../../js/common.js?v=20181213" type="text/javascript"></script>
<script type="text/javascript">
layui.config({
    base: '../../../layui/' //静态资源所在路径
}).extend({
    index: 'index' //主入口模块
}).use(['index','form','laydate','laypage','table','formSelects'], function(){
    var $ = layui.$
    ,admin = layui.admin
    , table = layui.table
    ,formSelects = layui.formSelects
    ,element = layui.element
    ,router = layui.router();
    element.render();
    element.on('tab(component-tabs-brief)', function(obj){

    });

    var laydate = layui.laydate
        ,form = layui.form
        ,laypage =layui.laypage
        ,layedit = layui.layedit;

    laydate.render({ 
        elem: '#createStarttime'
        ,type:'datetime'
    });
    laydate.render({ 
        elem: '#createEndtime'
        ,type:'datetime'
    });
    // laydate.render({ 
    //     elem: '#recordStartime'
    //     ,type:'datetime'
    // });
    // laydate.render({ 
    //     elem: '#recordEndtime'
    //     ,type:'datetime'
    // });
    //部门下拉
    $.fetch({//部门树列表
        url: "/gateway/department/tree",
        type: 'post',
        cb:function(rs){
            var formSelectsArr=rs[0].children[0].children;
            formSelectsArr.unshift({'name':'全部','id':'-1'})
            //新
            formSelects.config('newDeptId', {
                keyName: 'name',
                keyVal: 'id'
            })
            layui.formSelects.data('newDeptId', 'local', {
                radio: true,
                arr:formSelectsArr
            });

            //旧
            formSelects.config('oldDeptId', {
                keyName: 'name',
                keyVal: 'id'
            })
            layui.formSelects.data('oldDeptId', 'local', {
                radio: true,
                arr:formSelectsArr
            });
            // formSelects.render('deptId', {
            //     radio: true,                    //是否设置为单选模式
            // });
        }
    });
    
    $.fetch({//岗位树列表
        url: "/gateway/jobTitle/tree",
        type: 'post',
        cb:function(rs){
            var formSelectsArr=rs;
            formSelectsArr.unshift({'name':'全部','id':'-1'})
            
            //新
            formSelects.config('newTitleId', {
                keyName: 'title_name',
                keyVal: 'id'
            })
            layui.formSelects.data('newTitleId', 'local', {
                radio: true,
                arr:formSelectsArr
            });
            //旧
            formSelects.config('oldTitleId', {
                keyName: 'title_name',
                keyVal: 'id'
            })
            layui.formSelects.data('oldTitleId', 'local', {
                radio: true,
                arr:formSelectsArr
            });
            // formSelects.render('deptId', {
            //     radio: true,                    //是否设置为单选模式
            // });
        }
    });
    
    // 更换为数据表格
    var performance = table.render({
        elem: '#performance',
        url: urls+'/gateway/userChange/list', 
        limit: 10,
        method: 'post',
        contentType: 'application/json',
        page:true,
        loading: true,
        defaultToolbar: ['filter', 'print', 'exports'],
        limits:[10,20,30,40,50,60,70,80,90,100,200,500,1000,5000],
        toolbar:'<div><button  lay-event="add" class="layui-btn">新增人事变动</button><div>',
        text: {
            none: '暂无数据' 
        },
        cols: [[
            {sort: true,field:'id',title:'ID',minWidth:80},
            {sort: true,field:'change_type_name',title:'变动选项',minWidth:100},
            {sort: true,field:'created_at',title:'填写日期',minWidth:160},
            {sort: true,field:'creater_name',title:'填写人',minWidth:90},

            {sort: true,field:'change_title',title:'标题',minWidth:100},
            {sort: true,field:'changer_name',title:'姓名',minWidth:90},
            {sort: true,field:'oldDept_name',title:'原部门',minWidth:100},
            {sort: true,field:'oldTitle_name',title:'原职位',minWidth:100},
            {sort: true,field:'newDept_name',title:'新部门',minWidth:100},
            {sort: true,field:'newTitle_name',title:'新职位',minWidth:100},

            {sort: true,field:'change_cause',title:'变动原因',minWidth:160},
            {sort: true,field:'change_date',title:'调岗日期',minWidth:160},
            {sort: true,field:'effective_date',title:'生效日期',minWidth:160},
            {sort: true,field:'is_changed_name',title:'是否生效',minWidth:160},
            {sort: true,field:'change_status_name',title:'审批状态',minWidth:100},
            // {sort: true,field:'is_practice_name',title:'是否需要实习',minWidth:120},
            // {sort: true,field:'practice_startdate',title:'开始实习日期',minWidth:160},
            // {sort: true,field:'practice_month',title:'预计实习周期(月)',minWidth:160 },
            
            // {sort: true,field:'record_detail',title:'内容细节',minWidth:100},
            // {sort: true,field:'err_money_type_name',title:'错款类型',minWidth:100},
            // {sort: true,field:'err_money_submit',title:'提单金额',minWidth:100},
            // {sort: true,field:'err_money_total',title:'错款金额',minWidth:100},
            // {sort: true,field:'err_money_compensation',title:'赔偿金额',minWidth:100},
            // {sort: true,field:'record_status_name',title:'状态',minWidth:90},
            // {sort: true,field:'is_deleted_name',title:'是否删除',minWidth:90},
            // {sort: true,field:'is_edited_name',title:'是否修改',minWidth:90},
            {title:'操作',fixed: 'right',minWidth:80,templet: function (d){
                var btn ='<a class="layui-btn layui-btn-sm"  lay-event="details">详情</a>'   
                return btn
            }},
        
        ]]
        ,request: {
            pageName: 'currentIndex' //页码的参数名称，默认：page
            ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
        }
        ,parseData: function(res){ //res 即为原始返回的数据
            return {
                "status_code":res.status_code, //解析接口状态
                "message": res.message, //解析提示文本
                "count": res.data.total_count, //解析数据长度
                "data": res.data.data_list, //解析数据列表
                "curr":res.data.page_index
            };
        }
    })
    // $("#InquireSur").on("click",function(){
    //     var timeArr = $('#NoticeTime').val().split(' - ');
    //     var tit = $("#NoticeTit").val();
        
    // })
    form.on('submit(InquireSur)', function(data){
        // data.field['scoreTitle']=$("#scoreId").find("option:selected").text();
        // data.field['attachIds']=AttachsId.join(",");//附件
        // data.field['recorderName']=data.field.recorderUid;
        // data.field.recorderDeptId=$("#recorderDeptId").attr('subVal');
        // data.field.recorderTitleId=$("#recorderTitleId").attr('subVal');
        // data.field.creater=$("#creater").attr('subVal');
        // data.field.recorderUid=$("#recorderUid").attr('ts-selected');
        // console.log(data.field)
        data.field.oldDeptId=data.field.oldDeptId=='-1'?'':data.field.oldDeptId;
        data.field.newDeptId=data.field.newDeptId=='-1'?'':data.field.newDeptId;
        data.field.oldTitleId=data.field.oldTitleId=='-1'?'':data.field.oldTitleId;
        data.field.newTitleId=data.field.newTitleId=='-1'?'':data.field.newTitleId;
        
        data.field.changeType=data.field.changeType=='-1'?'':data.field.changeType;
        data.field.status=data.field.status=='-1'?'':data.field.status;
        performance.reload({
            where:data.field
            ,page: {
                curr: 1 //重新从第 1 页开始
            }
        });
    })
    table.on('tool(performance)', function(obj) {
        var data = obj.data; //获得当前行数据
        var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
        console.log(data)
        if (layEvent === 'details') {
            layer.open({
                title:false,
                content:'UsersChangeDetail.html',
                type:2,
                closeBtn:false,
                id:'UsersChangeDetail',
                area:['100%','100%'],
                success:function(layero,index){
                    var body = layer.getChildFrame('body', index);
					var iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：iframeWin.method();
					iframeWin.detailData={
						changeId:data.id,
						creater:data.creater,
					}
                },
                
            });
        }
    })
    table.on('toolbar(performance)', function(obj) {
        var checkStatus = table.checkStatus(obj.config.id);
            switch(obj.event){
                case 'add':
                layer.open({
                    title:false,
                    content:'UsersChangeAdd.html',
                    type:2,
                    closeBtn:false,
                    id:'UsersChangeAdd',
                    area:['100%','100%'],
                    success:function(layero,index){
                        var body = layer.getChildFrame('body', index);
                        var iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：iframeWin.method();
                       
                    },
                    end:function(){
                        performance.reload({
                            where: {
                            }
                            ,page:{
                                curr:1,
                            }
                        })
                    }
                });
                break;
             
        };
        // if (layEvent === 'details') {
        //     layer.open({
        //         title:false,
        //         content:'UsersChangeDetail.html',
        //         type:2,
        //         closeBtn:false,
        //         id:'UsersChangeDetail',
        //         area:['100%','100%'],
        //         success:function(layero,index){
        //             var body = layer.getChildFrame('body', index);
		// 			var iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：iframeWin.method();
		// 			iframeWin.detailData={
		// 				changeId:data.id,
		// 				creater:data.creater,
		// 			}
        //         }
        //     });
        // }
    })
    $("#backquireSur").on("click",function(){
        // performanceForm
        layui.formSelects.value('oldDeptId', []); 
        layui.formSelects.value('oldTitleId', []); 
        layui.formSelects.value('newDeptId', []); 
        layui.formSelects.value('newTitleId', []);

        form.val("performanceForm", {
            "status": "" // "name": "value"
            ,"changeId": ""
            ,"changeType": ''
            ,"changeTitle": ''
            ,"createrName": ''
            ,"createStarttime": ''
            ,"createEndtime": ''
            ,"changerName": ''
            // ,'oldDeptId':''
            // ,"oldTitleId":'0'
            // ,"newDeptId": ""
            // ,"newTitleId": ""
        })
        form.render()
        performance.reload({
            where: {
            }
            ,page:{
                curr:1,
            }
        })
    })
    
    // $('#performance').on("mouseenter", '.limit-width',function(){
    //     var tipsCont1 = '<div style="width:auto; min-width:30px; max-width: 360px; word-wrap: break-word;">'+$(this).text();+'</div>'
    //     var that = this;
    //     layer.tips(tipsCont1, that,{
    //           tips:[1,'#999']
    //           ,maxWidth: 'auto'
    //     });
    // });
})
</script>
</html>
